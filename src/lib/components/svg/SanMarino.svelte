<script>
    import { onMount } from "svelte";
    import panzoom from "@panzoom/panzoom";
    import addStadiumsToSvgMap from "@utils/addStadiumsToSvgMap";
    let {
        clickOutsideCountry,
        stadiumHover,
        stadiumLeave,
        countryObj,
        stadiumsArray,
    } = $props();
    let radius = $state(10);
    let stadiumObj = $state(null);
    let panzoomRef = $state(null);
    let flag = $state(1);

    onMount(() => {
        console.log("[Albania] onMount");
    });

    const initPanzoom = (node) => {
        node.addEventListener("panzoompan", (event) => {
            console.log("panzoompan: ", event.detail);
            if (event.detail.x != 0 || event.detail.y != 0) {
                flag = 0;
            }
        });
        node.addEventListener("panzoomzoom", (event) => {
            // console.log('panzoomzoom scale: ', event.detail?.scale)
            const scale = event.detail ? event.detail.scale : 10;
            const stadiumElement = document.getElementById("stadiums");
            if (!stadiumElement) {
                return;
            }
            const stadiums = stadiumElement.children;
            for (let i = 0; i < stadiums.length; i++) {
                stadiums[i].setAttribute("r", radius / scale);
            }
        });

        node.addEventListener("click", (event) => {
            if (flag == 1) {
                handleClick(event);
            } else {
                console.log("no click");
            }
            flag = 1;
        });
        panzoomRef = panzoom(node, {
            isSvg: true,
            cursor: "normal",
            disableZoom: false,
            maxScale: 8,
            minScale: 1,
            touchAction: "none",
            contain: "outside",
            panOnlyWhenZoomed: false,
            handleStartEvent: (event) => {
                event.preventDefault();
                event.stopPropagation();
            },
        });
        const zoom = (e) => {
            panzoomRef.zoomWithWheel(e);
        };
        node.addEventListener("wheel", zoom);
    };

    const handleClick = (e) => {
        console.log("[Albania] handleClick");
        // console.log('e.target: ', e.target);
        if (e.target.classList.contains("stadium")) {
            console.log("Click on stadium");
        }
        if (e.target.classList.contains("rectangle")) {
            console.log("Click on rectangle");
            panzoomRef.destroy();
            // dispatch("clickOutsideCountry");
            clickOutsideCountry();
        }
    };
    const handleMouseOverCircle = (e) => {
        console.log("[Albania] handleMouseOverCircle e.target: ", e.target);
        if (e.target.classList.contains("stadium")) {
            console.log("Click on stadium");
        }
        const stadiumId = parseInt(
            e.target.getAttribute("data-api-football-stadium-id"),
        );
        // console.log('stadiumId: ', stadiumId)
        const data = {
            stadiumId: stadiumId,
            clientX: e.clientX,
            clientY: e.clientY,
            rect: e.target.getBoundingClientRect(),
        };
        document.querySelectorAll(".stadium").forEach((element) => {
            element.classList.remove("hover");
        });
        e.target.classList.add("hover");
        stadiumHover(data);
    };
    const handleMouseOutCircle = (e) => {
        console.log("[Albania] handleMouseOutCircle e.target: ", e.target);
        if (!e.relatedTarget?.classList?.contains("tooltip")) {
            e.target.classList.remove("hover");
            stadiumLeave();
        }
    };
    const a = (node) => {
        stadiumObj = node;
        $effect(() => {
            return () => {};
        });
    };
    $effect(() => {
        addStadiumsToSvgMap(stadiumObj, stadiumsArray, countryObj.leagues);
    });
</script>

<svg
    xmlns="http://www.w3.org/2000/svg"
    version="1.1"
    id="map-albania"
    viewBox="0 0 1000 1000"
    width="100%"
    class=""
    use:initPanzoom
>
    <defs id="defs4">
        <style type="text/css" id="style2">
            .land {
                fill: #f7b7b7;
                fill-opacity: 1;
                stroke: white;
                stroke-opacity: 1;
                stroke-width: 0.5;
            }
            .rectangle:hover {
                fill: #bdbdbd;
                cursor: pointer;
            }
            #stadiums:focus {
                outline: none;
            }
            .hover {
                fill: #ffffff !important;
            }
            .test {
                border: 2px solid red;
            }
        </style>
        <!-- https://www.amcharts.com/svg-maps/ -->
        <!-- <amcharts:ammap
       projection="mercator"
       leftLongitude="12.400657"
       topLatitude="43.995696"
       rightLongitude="12.514129"
       bottomLatitude="43.894648" /> -->
        <!-- All areas are listed in the line below. You can use this list in your script. -->
        <!--{id:"SM-01"},{id:"SM-02"},{id:"SM-03"},{id:"SM-04"},{id:"SM-05"},{id:"SM-06"},{id:"SM-07"},{id:"SM-08"},{id:"SM-09"}-->
    </defs>
    <rect
        id="background"
        class="rectangle"
        stroke-width="0"
        stroke="#000"
        width="1000"
        height="1000"
        x="0"
        y="0"
        fill="#d3d3d3"
    />
    <g>
        <path
            id="SM-01"
            title="Acquaviva"
            class="land"
            d="m 331.51188,400.749 11.59187,3.0183 7.36626,11.12689 5.9387,28.27405 -4.69875,7.23575 -0.61997,7.0889 5.94685,11.95081 -35.80347,14.17781 -49.76919,-3.2467 19.72495,17.53057 -0.44051,19.64337 v 0 l 11.37162,37.95706 -32.68729,29.96267 -9.29144,5.13109 -7.81493,7.79862 -17.86503,9.53617 -13.49258,13.98203 -8.61437,2.25964 -9.25881,7.27653 -13.64758,2.78988 -11.33083,13.07655 v 0 l -5.02505,1.20732 -3.67089,-5.20452 -3.728,-8.7041 -0.14684,-9.79721 -8.7041,-3.9972 0.58734,-8.44306 -4.39691,-5.8408 -26.21836,-18.24028 -14.49596,-6.2242 -11.72239,-12.73393 -3.866676,-19.18655 1.541777,-40.71431 -4.176664,-15.5646 0.01632,-22.47404 4.062458,-17.18795 8.549105,-7.16233 15.19751,5.42477 15.89905,2.56963 10.88217,5.8408 7.65994,-2.18622 8.89172,0.48945 3.46696,-8.74489 17.96291,-3.2467 27.45015,-43.38999 5.72659,-2.71646 10.09089,0.37525 10.15614,4.52744 33.81303,-2.78989 33.15227,0.79129 z"
        />
        <path
            id="SM-02"
            title="Chiesanuova"
            class="land"
            d="m 298.80012,817.23251 0.16315,11.184 2.92856,3.16513 10.13983,3.88299 5.13925,6.44446 3.74431,9.38118 13.11734,9.82984 7.39889,13.22338 1.01969,20.1573 -16.25798,21.24225 0.84022,8.28807 v 0 l -4.29087,1.8436 -9.23434,9.34855 -11.46951,3.27118 -12.26895,-0.82392 -8.8183,-12.39947 -5.71029,2.71647 -6.50972,-1.43573 -18.5992,9.60959 -6.31394,11.82844 -10.66192,9.4546 -13.6231,4.93531 -25.14155,4.66612 -15.11594,0.87285 -13.05207,-5.65318 -6.48525,-0.71786 -14.55306,-8.99777 -13.73731,-3.46696 11.2411,-19.32523 0.61181,-8.4349 5.57161,-11.75502 5.10662,-8.66332 8.36964,-5.99579 2.03939,-7.90466 -14.9691,-38.96044 -18.33,-68.67838 -1.52546,-6.14264 1.23179,-13.41916 4.82111,-15.85827 9.12829,-14.92831 29.73426,-35.90952 2.79803,-6.59129 -2.48805,-20.6957 5.02505,-1.91702 v 0 l 25.14156,-5.39214 11.51845,0.18763 11.65714,8.59805 15.88274,1.8436 7.26021,3.46696 2.30859,10.93111 10.94743,9.34039 12.83997,-9.00593 1.06048,22.95534 13.59048,-6.29763 4.33165,0.26104 -1.06864,25.2884 -12.93786,2.71646 -11.53477,-0.90549 -11.41241,8.17386 4.40507,4.44586 5.22083,12.02423 0.0816,6.28947 -7.63546,18.95813 0.0816,6.28947 17.53873,16.35588 16.69849,8.73673 z"
        />
        <path
            id="SM-03"
            title="Domagnano"
            class="land"
            d="m 843.96076,269.52672 0.1142,7.69256 10.3193,15.69512 -16.66587,42.98211 37.59813,56.9723 v 0 l -8.54095,6.48525 -12.73393,15.98879 -12.83182,9.01409 -10.6456,11.57556 -10.40902,26.95253 -4.93532,6.11 -5.09847,-2.98566 -17.26136,1.77835 -2.18622,-1.17469 2.79803,-5.87343 -1.44388,-1.24811 -10.80059,1.1339 -9.5117,-10.2214 -12.3179,-3.6138 -12.88892,4.82111 -6.59945,-8.40227 -7.0726,9.12014 -13.01128,-2.8633 -7.11338,6.33025 -5.74291,0.60366 -4.28272,3.24671 -10.06641,1.01153 -12.84813,9.01409 -11.50214,0.48945 -1.32153,8.55727 -5.57976,12.44026 0.84839,9.69116 -17.01664,17.14716 -11.44504,5.39214 -0.35077,24.50527 -15.67881,12.09764 v 0 l -21.60934,0.82391 -13.71283,-2.07202 -25.41076,-12.77471 -8.63884,-0.48946 2.70831,-11.46135 -3.89931,-19.86362 -12.15474,6.81971 4.03798,-19.97783 -18.83577,-7.16233 -8.647,0.22841 -15.78485,4.41323 -6.57498,-6.29762 -0.24473,-16.78007 14.79779,-22.50667 2.76541,-7.27653 2.01491,-9.27513 -0.29367,-20.95674 7.68441,-16.17641 1.96596,-12.1058 4.93532,-8.18202 9.98484,-6.63208 v 0 l 28.73903,-5.05768 17.65293,-23.52637 35.80347,-15.57275 1.34599,-5.73476 5.00058,-2.5941 4.36429,1.6152 11.77134,16.29062 11.55924,2.9775 3.74431,9.43013 9.41381,3.20591 8.85094,13.80257 4.29087,-1.85176 9.93589,-10.81691 7.14601,-3.54853 11.2982,-15.15672 7.14601,-3.54854 9.16092,-14.89567 12.13843,-6.18342 6.34657,-9.04672 6.52604,2.14543 25.1905,-1.91702 20.00231,-11.16768 14.38991,-2.14544 15.64617,-12.82366 z"
        />
        <path
            id="SM-04"
            title="Faetano"
            class="land"
            d="m 895.27988,528.10461 -16.43746,3.54038 -8.492,10.67007 -7.68441,16.16825 -14.47149,14.16966 -1.02785,10.48245 -17.55504,30.4929 -1.98228,11.37978 -5.58792,12.44026 0.22026,14.65911 -6.95023,16.80454 -9.22619,10.02563 -13.60678,5.61239 -12.95419,1.32152 -9.28329,4.44586 -12.71761,16.6985 -1.37047,6.44446 -4.95979,4.70691 -10.50691,19.25996 1.70492,18.68894 3.64643,2.40648 0.0653,4.18482 v 0 l -15.82564,1.62335 -37.48393,-1.69677 -1.25626,12.69314 -12.25263,-0.14684 -1.45205,-0.53024 -0.90548,-13.18259 -21.70723,-5.46556 -7.42337,-15.30355 -11.54293,-0.89733 -3.22223,-22.72693 -12.13027,7.53758 v 0 l -7.33363,-6.93392 -13.01129,-4.93531 -2.96935,-4.60086 v 0 l 17.1798,-8.05965 2.07201,-5.80818 9.25066,-7.94545 -2.9775,-6.67287 6.44446,-3.46696 -0.90549,-11.07794 3.55669,-3.883 4.30718,-1.13389 -0.0816,-5.57161 -5.25346,-13.45995 14.85489,-18.28106 7.63546,-19.66784 8.44306,-13.45995 -0.3263,-22.31089 -12.20369,4.02983 -9.96036,7.31731 -21.8867,-18.69709 v 0 l 15.67881,-12.09764 0.35077,-24.50527 11.44504,-5.39214 17.01664,-17.14716 -0.84839,-9.69116 5.57976,-12.44026 1.32153,-8.55727 11.50214,-0.48945 12.84813,-9.01409 10.06641,-1.01153 4.28272,-3.24671 5.74291,-0.60366 7.11338,-6.33025 13.01128,2.8633 7.0726,-9.12014 6.59945,8.40227 12.88892,-4.82111 12.3179,3.6138 9.5117,10.2214 10.80059,-1.1339 1.44388,1.24811 -2.79803,5.87343 2.18622,1.17469 17.26136,-1.77835 5.09847,2.98566 4.93532,-6.11 10.40902,-26.95253 10.6456,-11.57556 12.83182,-9.01409 12.73393,-15.98879 8.54095,-6.48525 v 0 l 13.27233,20.28782 14.4878,53.75823 1.10127,26.43045 z"
        />
        <path
            id="SM-05"
            title="Fiorentino"
            class="land"
            d="m 597.58655,708.14165 2.96935,4.60086 13.01129,4.93531 7.33363,6.93392 v 0 l -2.63489,17.14716 3.23039,16.46193 0.8076,21.33198 -6.22421,4.10325 -7.5702,9.75642 -15.948,8.9733 0.26104,15.71143 13.26417,2.21886 6.4934,-12.69314 16.76376,8.96514 v 13.10917 l -11.90186,9.34855 -1.36231,10.84954 -4.31534,5.61239 -6.49341,2.21885 -2.4391,3.39354 20.29597,36.65186 -5.96317,13.07654 h -10.27035 l -27.8417,32.16521 -0.29367,16.53534 v 0 l -9.82169,1.69677 -6.4363,4.14404 -5.80002,-2.89593 -12.09764,10.35192 -15.01804,7.12154 -4.09509,14.38991 -14.50411,-5.46555 -3.59748,0.34261 -13.6231,3.49959 -9.98484,6.63208 -19.49654,-2.86329 -5.11478,-4.36429 -27.58882,-13.94125 -2.98566,-6.66471 2.71646,-11.4532 -7.94545,-2.67567 -3.65458,-3.12434 -0.79944,-4.10325 3.54038,-5.23714 -2.92856,-2.52068 4.87005,-11.68161 -2.22701,-3.95641 -10.20509,-8.73673 -20.32044,-9.75643 -8.13308,-14.5449 -22.2701,5.09031 -16.3314,15.67064 5.12294,6.43631 -4.23377,5.35135 -2.76541,-2.37385 -3.66274,0.15499 -5.05768,4.78033 -2.22701,-5.35135 -5.04952,0.53024 v 0 l -0.84022,-8.28807 16.25798,-21.24225 -1.01969,-20.1573 -7.39889,-13.22338 -13.11734,-9.82984 -3.74431,-9.38118 -5.13925,-6.44446 -10.13983,-3.88299 -2.92856,-3.16513 -0.16315,-11.184 v 0 l 22.93086,-7.9536 12.96234,-1.32153 27.36857,-0.0326 13.76178,4.85374 35.01218,-19.66784 8.66332,1.88439 20.14914,-1.35415 5.80817,2.8633 14.67542,-30.14213 v 0 l 14.38991,-1.46836 23.65689,-8.06781 30.87631,-7.34179 20.70385,-13.34575 22.92271,-8.66331 7.77414,-9.15277 z"
        />
        <path
            id="SM-06"
            title="Borgo Maggiore"
            class="land"
            d="m 532.8238,372.28733 -9.98484,6.63208 -4.93532,8.18202 -1.96596,12.1058 -7.68441,16.17641 0.29367,20.95674 -2.01491,9.27513 -2.76541,7.27653 -14.79779,22.50667 0.24473,16.78007 6.57498,6.29762 15.78485,-4.41323 8.647,-0.22841 18.83577,7.16233 -4.03798,19.97783 12.15474,-6.81971 3.89931,19.86362 -2.70831,11.46135 8.63884,0.48946 25.41076,12.77471 13.71283,2.07202 21.60934,-0.82391 v 0 l 21.8867,18.69709 9.96036,-7.31731 12.20369,-4.02983 0.3263,22.31089 -8.44306,13.45995 -7.63546,19.66784 -14.85489,18.28106 5.25346,13.45995 0.0816,5.57161 -4.30718,1.13389 -3.55669,3.883 0.90549,11.07794 -6.44446,3.46696 2.9775,6.67287 -9.25066,7.94545 -2.07201,5.80818 -17.1798,8.05965 v 0 l -17.13084,10.18062 -7.77414,9.15277 -22.92271,8.66331 -20.70385,13.34575 -30.87631,7.34179 -23.65689,8.06781 -14.38991,1.46836 v 0 l 3.49959,-8.05966 1.26442,-11.30636 9.86247,-15.00172 7.10523,-6.33026 -0.76681,-4.10324 v 0 l -1.56625,-8.21465 v 0 l -1.7865,-22.87376 -4.58455,-17.71819 -0.46498,-31.39024 -9.42196,-3.91562 -1.65598,-14.51228 -3.73616,-10.09904 -26.37335,-28.04564 -12.36684,-7.79862 -33.99249,-9.76458 -33.17674,-2.18622 -13.27233,-19.60258 -12.41578,-11.98344 -2.97751,-5.99579 -11.60003,-5.09031 -20.95673,-4.82111 v 0 l 0.44051,-19.64337 -19.72495,-17.53057 49.76919,3.2467 35.80347,-14.17781 -5.94685,-11.95081 0.61997,-7.0889 4.69875,-7.23575 -5.9387,-28.27405 -7.36626,-11.12689 -11.59187,-3.0183 v 0 l 10.59665,-15.07514 8.55726,-5.76739 50.78889,-73.08345 6.41183,-4.14403 15.06698,-5.05768 v 0 l 25.98995,3.62195 19.41495,-2.71647 25.74522,-12.44025 10.62112,-12.29342 11.43688,-5.39214 12.39947,9.91957 -1.91702,16.29062 -18.38711,22.89008 11.73055,14.85489 -10.55586,15.76038 16.73928,12.25263 z"
        />
        <path
            id="SM-07"
            title="San Marino"
            class="land"
            d="m 290.74862,517.54875 20.95673,4.82111 11.60003,5.09031 2.97751,5.99579 12.41578,11.98344 13.27233,19.60258 33.17674,2.18622 33.99249,9.76458 12.36684,7.79862 26.37335,28.04564 3.73616,10.09904 1.65598,14.51228 9.42196,3.91562 0.46498,31.39024 4.58455,17.71819 1.7865,22.87376 v 0 l 1.56625,8.21465 v 0 l 0.76681,4.10324 -7.10523,6.33026 -9.86247,15.00172 -1.26442,11.30636 -3.49959,8.05966 v 0 l -14.67542,30.14213 -5.80817,-2.8633 -20.14914,1.35415 -8.66332,-1.88439 -35.01218,19.66784 -13.76178,-4.85374 -27.36857,0.0326 -12.96234,1.32153 -22.93086,7.9536 v 0 l -3.01014,-8.06781 -16.69849,-8.73673 -17.53873,-16.35588 -0.0816,-6.28947 7.63546,-18.95813 -0.0816,-6.28947 -5.22083,-12.02423 -4.40507,-4.44586 11.41241,-8.17386 11.53477,0.90549 12.93786,-2.71646 1.06864,-25.2884 -4.33165,-0.26104 -13.59048,6.29763 -1.06048,-22.95534 -12.83997,9.00593 -10.94743,-9.34039 -2.30859,-10.93111 -7.26021,-3.46696 -15.88274,-1.8436 -11.65714,-8.59805 -11.51845,-0.18763 -25.14156,5.39214 v 0 l -1.69677,-16.58429 v 0 l 11.33083,-13.07655 13.64758,-2.78988 9.25881,-7.27653 8.61437,-2.25964 13.49258,-13.98203 17.86503,-9.53617 7.81493,-7.79862 9.29144,-5.13109 32.68729,-29.96267 z"
        />
        <path
            id="SM-08"
            title="Montegiardino"
            class="land"
            d="m 620.90082,724.61174 12.13027,-7.53758 3.22223,22.72693 11.54293,0.89733 7.42337,15.30355 21.70723,5.46556 0.90548,13.18259 1.45205,0.53024 12.25263,0.14684 1.25626,-12.69314 37.48393,1.69677 15.82564,-1.62335 v 0 l -2.08834,5.80001 2.33306,10.25404 -1.85176,21.1362 3.63827,3.12434 0.10604,6.9747 5.76739,0.11421 5.07399,2.96934 0.13868,8.36965 -17.0248,18.53394 -1.99044,11.37978 -6.24868,16.01326 -17.57135,29.04086 -6.15895,22.30273 -4.61717,29.11429 -86.38026,4.74769 -27.26252,6.28947 -13.20706,0.67707 v 0 l 0.29367,-16.53534 27.8417,-32.16521 h 10.27035 l 5.96317,-13.07654 -20.29597,-36.65186 2.4391,-3.39354 6.49341,-2.21885 4.31534,-5.61239 1.36231,-10.84954 11.90186,-9.34855 v -13.10917 l -16.76376,-8.96514 -6.4934,12.69314 -13.26417,-2.21886 -0.26104,-15.71143 15.948,-8.9733 7.5702,-9.75642 6.22421,-4.10325 -0.8076,-21.33198 -3.23039,-16.46193 z"
        />
        <path
            id="SM-09"
            title="Serravalle"
            class="land"
            d="m 892.36764,35.478566 4.84558,35.460853 -8.62253,1.623351 -10.00115,5.922379 -20.41834,31.504441 4.52744,13.50074 4.15219,36.66817 7.46416,18.10159 0.1142,7.69257 -21.34014,18.97445 -20.12466,3.46696 6.11816,23.87714 4.87821,37.25551 v 0 l -23.6732,6.64024 -15.64617,12.82366 -14.38991,2.14544 -20.00231,11.16768 -25.1905,1.91702 -6.52604,-2.14543 -6.34657,9.04672 -12.13843,6.18342 -9.16092,14.89567 -7.14601,3.54854 -11.2982,15.15672 -7.14601,3.54853 -9.93589,10.81691 -4.29087,1.85176 -8.85094,-13.80257 -9.41381,-3.20591 -3.74431,-9.43013 -11.55924,-2.9775 -11.77134,-16.29062 -4.36429,-1.6152 -5.00058,2.5941 -1.34599,5.73476 -35.80347,15.57275 -17.65293,23.52637 -28.73903,5.05768 v 0 l -6.67288,-11.91818 -16.73928,-12.25263 10.55586,-15.76038 -11.73055,-14.85489 18.38711,-22.89008 1.91702,-16.29062 -12.39947,-9.91957 -11.43688,5.39214 -10.62112,12.29342 -25.74522,12.44025 -19.41495,2.71647 -25.98995,-3.62195 v 0 l 22.62088,-28.20064 123.88865,-100.24808 12.85629,-7.61915 11.4532,-3.96457 7.08075,-7.73335 12.8726,-6.94207 16.52719,-3.09171 21.42172,-12.70946 23.77109,-1.06048 9.30776,-3.05092 26.33256,-22.33536 20.89147,-0.0326 4.95163,-6.110006 8.55727,-5.775542 6.29762,-12.562621 6.37105,-6.942072 15.10777,-1.582564 7.83125,-7.088907 10.06641,-1.060481 6.4363,-3.434327 7.76599,-11.314516 -2.96119,-4.600856 0.6526,-3.548533 7.87203,-3.62195 2.74094,-9.356705 4.28271,-3.246704 7.93729,-0.146836 5.61239,-8.94067 7.93729,1.239947 5.65318,-8.9814582 2.14544,-0.1876235 5.94685,11.2818857 2.87146,0.375248 3.53221,-4.560069 5.05768,-0.5302402 6.5342,4.9434732 5.06583,0.8647 3.54038,-3.165128 0.5955,-9.8461583 4.28271,-1.85176294 4.35613,1.66413934 z"
        />
    </g>
    <!-- Triadic colors: -->
    <!-- https://www.color-hex.com/color/f7b7b7 -->
    <g
        id="stadiums"
        data-country="san_marino"
        data-circle-radius={radius}
        data-circle-colors="#b7b7f7,#b7f7b7"
        onmouseover={handleMouseOverCircle}
        onmouseout={handleMouseOutCircle}
        onfocus={() => {}}
        role="presentation"
        onblur={() => {}}
        use:a
    ></g>
    >
</svg>
