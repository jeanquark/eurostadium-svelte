<script>
    import { createEventDispatcher, onMount } from "svelte";
    import panzoom from "@panzoom/panzoom";
    import { stadiumStore } from "../../../store/stadium";
    import addStadiumsToSvgMap from "@utils/addStadiumsToSvgMap";
    import filterStadiums from "@utils/filterStadiums";
    const dispatch = createEventDispatcher();

    export let countryObj;
    export let stadiumsArray;
    let radius = 10;
    let stadiumObj;
    let panzoomRef;
    let flag = 1;
    $: updateStadiums(stadiumsArray);

    onMount(() => {
        console.log("[Austria] onMount");
        console.log("stadiumsArray: ", stadiumsArray);
    });

    const initPanzoom = (node) => {
        node.addEventListener("panzoompan", (event) => {
            if (event.detail.x != 0 || event.detail.y != 0) {
                flag = 0;
            }
        });
        node.addEventListener("panzoomzoom", (event) => {
            const scale = event.detail ? event.detail.scale : 10;
            const stadiumElement = document.getElementById("stadiums");
            if (!stadiumElement) {
                return;
            }
            const stadiums = stadiumElement.children;
            for (let i = 0; i < stadiums.length; i++) {
                stadiums[i].setAttribute("r", radius / scale);
            }
        });

        node.addEventListener("click", (event) => {
            if (flag == 1) {
                handleClick(event);
            }
            flag = 1;
        });
        panzoomRef = panzoom(node, {
            isSvg: true,
            cursor: "normal",
            disableZoom: false,
            maxScale: 8,
            minScale: 1,
            touchAction: "none",
            contain: "outside",
            panOnlyWhenZoomed: false,
            handleStartEvent: (event) => {
                event.preventDefault();
                event.stopPropagation();
            },
        });
        const zoom = (e) => {
            panzoomRef.zoomWithWheel(e);
        };
        node.addEventListener("wheel", zoom);
    };

    const handleClick = (e) => {
        if (e.target.classList.contains("rectangle")) {
            panzoomRef.destroy();
            dispatch("clickOutsideCountry");
        }
    };
    const handleMouseOverCircle = (e) => {
        const stadiumId = parseInt(
            e.target.getAttribute("data-api-football-stadium-id"),
        );
        const data = {
            stadiumId: stadiumId,
            clientX: e.clientX,
            clientY: e.clientY,
            rect: e.target.getBoundingClientRect(),
        };
        document.querySelectorAll(".stadium").forEach((element) => {
            element.classList.remove("hover");
        });
        e.target.classList.add("hover");
        dispatch("stadiumHover", data);
    };
    const handleMouseOutCircle = (e) => {
        if (!e.relatedTarget?.classList?.contains("tooltip")) {
            e.target.classList.remove("hover");
            dispatch("stadiumLeave");
        }
    };
    const a = (node, stadiums) => {
        console.log("a: ", stadiums);

        stadiumObj = node;
        addStadiumsToSvgMap(stadiumObj, stadiums, countryObj.leagues);
    };
    const updateStadiums = (stadiums) => {
        console.log("[Austria] updateStadiums: ", stadiums);
        if (stadiumObj) {
            addStadiumsToSvgMap(stadiumObj, stadiums, countryObj.leagues);
        }
    };
</script>

<svg
    xmlns="http://www.w3.org/2000/svg"
    version="1.1"
    id="map-austria"
    viewBox="0 0 1000 1000"
    width="100%"
    class=""
    use:initPanzoom
>
    <defs id="defs4">
        <style type="text/css" id="style2">
            .land {
                fill: #f69a69;
                fill-opacity: 1;
                stroke: white;
                stroke-opacity: 1;
                stroke-width: 0.5;
            }
            .rectangle:hover {
                fill: #bdbdbd;
                cursor: pointer;
            }
            #stadiums:focus {
                outline: none;
            }
            .hover {
                fill: #ffffff !important;
            }
            .test {
                border: 2px solid red;
            }
        </style>
        <!-- <amcharts:ammap projection="mercator" leftLongitude="9.501127" topLatitude="49.015154" rightLongitude="17.163378" bottomLatitude="46.370917"></amcharts:ammap> -->
        <!-- All areas are listed in the line below. You can use this list in your script. -->
        <!-- {id:"AT-1"},{id:"AT-2"},{id:"AT-3"},{id:"AT-4"},{id:"AT-6"},{id:"AT-5"},{id:"AT-7"},{id:"AT-8"},{id:"AT-9"}-->
    </defs>
    <rect
        id="background"
        class="rectangle"
        stroke-width="0"
        stroke="#000"
        width="1000"
        height="1000"
        x="0"
        y="0"
        fill="#d3d3d3"
    />
    <g>
        <path
            d="m 987.44892,421.26672 -0.1305,16.19856 11.89196,4.77964 -8.6131,7.09605 -1.17452,18.48233 -9.83658,3.22992 8.25425,9.7061 2.15329,19.36323 -27.03024,3.84981 -2.28378,-6.28041 -5.02433,7.35706 -10.2444,0.24468 -3.83349,-9.90183 -14.68148,-5.44846 -23.97974,18.46604 29.75445,8.189 8.23794,16.05173 -8.23794,7.667 1.22346,8.45 -10.97849,9.37982 -16.93264,-0.11418 -1.69651,10.57066 7.22653,13.84953 -9.62452,14.37153 5.04066,12.05511 9.78764,3.01786 -8.74362,6.24778 7.5691,6.94924 -10.61959,5.28534 9.64083,5.25269 -28.792,-2.21852 -2.31642,9.73872 -18.44972,16.49219 -17.51989,7.81378 v 0 l 20.66827,-29.98282 -8.77628,-16.37799 3.47463,-13.06652 -10.97848,-44.68061 17.92772,-8.189 v 0 l 14.51833,-6.28043 7.63437,-11.5331 -3.29519,-9.65716 7.69963,-15.08928 -8.54788,-8.36844 -0.55464,-18.71072 -4.56756,-1.61497 2.28376,-3.50725 5.10591,4.30658 8.20531,-10.47278 -4.91012,-4.46969 8.10742,-2.96893 4.66544,-10.34229 9.23303,-1.69653 7.89536,10.91324 15.56238,-15.3503 1.10926,-9.0862 15.856,-2.90368 8.05849,-9.15143 11.66361,9.91814 4.55127,-9.85292 -5.26903,-5.93783 7.89537,3.67038 4.19237,-6.37829 v 0 z"
            class="land"
            title="Burgenland"
            id="AT-1"
            style=""
        />
        <path
            d="m 410.79324,616.62821 10.79904,-5.69314 0.68513,5.36687 23.73505,4.19239 18.07452,12.10406 24.86065,-5.72577 3.52355,-8.89046 11.48416,-0.57093 4.61651,5.38321 38.3839,5.67682 11.81043,18.17242 v 0 l 8.59683,6.49246 10.66855,-2.13697 10.99476,-15.83969 24.48546,-13.29489 3.98031,9.06989 17.30782,0.55463 4.38812,8.4337 9.95079,-8.25425 17.9277,4.94277 29.83603,-9.99972 23.91448,26.52453 -6.72085,23.45773 6.96555,3.26256 -0.86459,18.25397 5.7258,4.01293 v 0 l -11.53312,9.28196 -3.03418,-4.87752 -11.43523,4.87752 -6.44353,17.78088 -13.44171,1.35396 -1.84335,7.11236 -14.81198,6.57404 -3.01786,10.61959 -5.33425,-9.72239 -9.91817,0.47307 -2.07171,-4.60019 -35.46392,2.26747 -5.28534,-8.04218 -26.80184,-8.40107 -15.26874,2.9363 -55.00659,-13.50696 -17.47095,5.17114 -9.29826,-6.99818 -41.85852,-3.53986 -20.27674,-9.80395 v 0 l 3.1973,-15.31767 28.09055,-4.74701 4.6165,-5.6116 -28.67782,-31.95668 -2.90366,-6.62297 6.29673,-8.62943 -7.2918,-0.73409 z"
            class="land"
            title="Carinthia"
            id="AT-2"
            style=""
        />
        <path
            d="m 721.86106,244.63229 15.95386,4.24132 0.55464,9.99971 13.16439,-2.20221 2.25115,-8.17269 24.74644,8.54787 28.88987,19.00436 19.37956,-4.30657 33.22907,25.80678 37.20938,3.44199 9.10251,-13.93111 11.89199,-2.75684 16.01912,6.44353 2.43061,10.47279 28.66149,2.02278 6.63929,33.73477 -13.19701,18.79229 -2.23485,13.55589 16.1007,22.72366 2.28377,18.07451 11.98987,10.47278 v 0 l -4.19238,6.37829 -7.89536,-3.67038 5.28531,5.93783 -4.56755,9.85292 -11.6473,-9.91814 -8.07482,9.15143 -15.83968,2.88736 -1.10925,9.08622 -15.56238,15.35029 -7.89537,-10.91323 -9.23301,1.68021 -4.64914,10.35859 -8.12375,2.96892 4.91014,4.4697 -8.20532,10.47279 -5.10588,-4.29027 -2.28378,3.50725 4.56756,1.59865 0.55463,18.72704 8.53157,8.36844 -7.6833,15.08928 3.27886,9.64084 -7.63436,11.53311 -14.50205,6.28043 v 0 l -7.66698,-18.90649 -7.19392,6.50879 -18.00928,-8.67839 -3.63775,-7.71593 -5.39952,0.88089 1.46816,-10.14653 -15.02405,-2.08803 -3.16466,-14.9588 -5.4974,2.03912 -8.51526,-9.99973 -12.93601,0.81564 -13.24594,-7.32443 -0.81565,-5.72578 -13.71903,-0.91351 -1.46814,5.66053 -9.29826,-0.89722 -2.34905,7.96063 -29.50976,1.64758 -5.80732,6.32935 -24.63227,-7.14497 v 0 l -3.73562,-19.86894 7.09605,-4.3555 -0.58726,-5.59528 -4.17608,-6.34565 -29.47713,-11.32105 -5.90519,-9.16776 4.20869,-34.59933 11.36996,-1.56602 15.15456,13.47433 18.43341,-6.62298 6.42721,-8.22162 12.21827,6.2804 1.58232,-11.15792 -0.70145,-12.00619 -5.57895,-0.88087 2.85472,-12.90339 -6.18252,0.17946 3.0994,-6.54143 -9.60819,-11.631 7.25916,-4.76331 -30.01545,-15.57868 v 0 l 15.33398,-38.1392 22.18535,1.40289 -0.16313,-41.14075 2.26747,-6.9166 z m 169.19583,143.89476 v 0 l -9.98341,8.22164 -6.60666,-4.0619 -2.90368,17.7809 5.05696,9.15145 27.92742,0.84826 10.14655,-7.63437 7.27547,4.29026 -3.00154,-24.38755 -18.95541,-10.76641 v 0 l -0.99508,-0.35888 v 0 l -5.15483,6.9166 v 0 l -0.81564,-1.20714 z"
            class="land"
            title="Lower Austria"
            id="AT-3"
            style=""
        />
        <path
            d="m 567.21619,292.93433 27.6175,18.87385 -6.41091,6.88399 7.35704,8.66207 26.70396,2.74054 8.23795,5.72578 6.7861,-8.07481 5.6279,0.92982 5.18745,-11.71254 4.24132,6.11727 7.65068,2.49585 6.50878,-4.79596 10.48909,8.53159 v 0 l 30.01547,15.57866 -7.25918,4.76332 9.6082,11.64731 -3.09941,6.5251 6.18253,-0.16314 -2.85475,12.9034 5.57897,0.8809 0.71777,12.00618 -1.59865,11.15792 -12.21824,-6.28041 -6.42724,8.22163 -18.44971,6.62295 -15.15455,-13.45799 -11.36998,1.5497 -4.20869,34.59932 5.88891,9.16777 29.49344,11.32106 4.15976,6.32934 0.58726,5.61157 -7.09605,4.35553 3.7193,19.86891 v 0 l -5.88889,-3.16467 -21.77753,10.48909 -0.91351,5.72578 -26.99761,14.22471 -7.38966,-1.10926 -3.08311,-7.37336 -23.68612,6.41091 0.53833,-9.80396 -5.97048,-6.41091 -30.08069,-3.03417 -10.88062,17.06312 -0.21207,8.6784 8.07482,5.93783 -4.19237,17.45464 -17.92772,-2.12064 v 0 l -14.15946,-12.07144 5.93783,-15.79074 -5.04065,-4.53496 7.92802,-14.02895 -13.89848,-4.50233 3.42568,-9.47771 6.88398,2.67529 1.35396,-5.00799 -17.84615,0.73405 -13.60483,-6.86766 -0.92981,-23.21303 10.14653,2.07171 1.51708,-7.1613 -9.24933,-6.72086 -19.60792,7.96064 -12.90341,-14.42048 -14.97509,1.59864 -9.49401,7.38969 v 0 l -13.32753,-15.59499 0.16315,-9.62452 34.12625,-25.44787 40.78187,-13.2949 13.63747,-20.48881 v -25.04007 l 9.11882,-6.18254 29.02039,14.76304 11.92461,-19.55898 1.85965,-16.54112 -5.57896,-3.32781 z"
            class="land"
            title="Upper Austria"
            id="AT-4"
            style=""
        />
        <path
            d="m 683.42821,492.52081 24.63227,7.14499 5.82364,-6.34567 29.49344,-1.63127 2.34905,-7.97693 9.31457,0.8972 1.45183,-5.67684 13.73535,0.91351 0.81563,5.72578 13.24596,7.32443 12.91969,-0.81564 8.51526,10.01603 5.4974,-2.05542 3.16466,14.9588 15.02405,2.08803 -1.46816,10.14653 5.39952,-0.88089 3.63775,7.71593 18.00928,8.67839 7.19392,-6.50879 7.61807,18.9228 v 0 l -17.92772,8.189 10.97848,44.68061 -3.47463,13.06652 8.77628,16.37799 -20.66827,29.98282 v 0 l -1.50078,17.97666 6.23148,16.01912 -25.17056,-12.74025 -31.92407,6.19884 -12.20193,14.28996 -11.53312,-7.74855 -45.46361,0.66883 v 0 l -5.7258,-4.01293 0.86459,-18.25397 -6.96555,-3.26256 6.72085,-23.45773 -23.91448,-26.52453 -29.83603,9.99972 -17.9277,-4.94277 -9.95079,8.25425 -4.38812,-8.4337 -17.30782,-0.55463 -3.98031,-9.06989 -24.48546,13.29489 -10.99476,15.83969 -10.66855,2.13697 -8.59683,-6.49246 v 0 l 16.21488,-23.19675 -3.62143,-8.09112 14.90985,-6.13358 -12.52819,-8.14007 -9.72239,-21.20657 -14.58359,6.6556 -13.58853,-4.69808 -5.66052,-26.32878 2.85472,-10.01601 v 0 l 17.92772,2.12064 4.19237,-17.45464 -8.07482,-5.93783 0.21207,-8.6784 10.88062,-17.06312 30.08069,3.03417 5.97048,6.41091 -0.53833,9.80396 23.68612,-6.41091 3.08311,7.37336 7.38966,1.10926 26.99761,-14.22471 0.91351,-5.72578 21.77753,-10.48909 z"
            class="land"
            title="Styria"
            id="AT-6"
            style=""
        />
        <path
            d="m 438.52492,444.12089 9.49401,-7.38969 14.97509,-1.59864 12.90341,14.42048 19.60792,-7.96064 9.24933,6.72086 -1.51708,7.1613 -10.14653,-2.07171 0.92981,23.21303 13.60483,6.86766 17.84615,-0.73405 -1.35396,5.00799 -6.88398,-2.67529 -3.42568,9.47771 13.89848,4.50233 -7.92802,14.02895 5.04065,4.53496 -5.93783,15.79074 14.15946,12.07144 v 0 l -2.85472,10.01601 5.66052,26.32878 13.58853,4.69808 14.58359,-6.6556 9.72239,21.20657 12.52819,8.14007 -14.90985,6.13358 3.62143,8.09112 -16.21488,23.19675 v 0 l -11.81043,-18.17242 -38.3839,-5.67682 -4.61651,-5.38321 -11.48416,0.57093 -3.52355,8.89046 -24.86065,5.72577 -18.07452,-12.10406 -23.73505,-4.19239 -0.68513,-5.36687 -10.79904,5.69314 v 0 l -20.08099,-10.47279 -12.34876,0.83194 -21.14131,15.92124 v 0 l -13.26227,-2.33271 v 0 l -7.04712,-21.7612 3.70301,-20.83139 46.96439,-3.81719 4.64914,-13.36014 9.36352,0.22838 7.34074,-14.25733 8.49894,-2.1696 -8.85782,-13.34383 4.60019,-5.70947 -11.85936,-4.92645 v -5.83995 0 l 3.964,-7.7975 23.21303,-0.14681 -3.09942,4.30657 8.53156,7.45492 -5.70946,5.97048 2.10435,4.95906 26.80185,17.73197 5.77471,-5.56267 4.3555,-37.45406 -8.28687,-7.04712 h -14.20841 l 12.46294,-24.33861 z"
            class="land"
            title="Salzburg"
            id="AT-5"
            style=""
        />
        <path
            d="m 357.22218,622.9086 21.14131,-15.92124 12.34876,-0.84826 20.08099,10.48911 v 0 l 8.84151,10.83166 7.2918,0.71777 -6.29673,8.62944 2.90366,6.62297 28.67782,31.95669 -4.63281,5.61158 -28.09057,4.747 -3.19729,15.31768 v 0 l -16.45955,0.96244 -19.39587,-9.1025 -7.87906,-14.25736 -9.28195,-1.71282 3.03418,-10.58698 -3.98032,-8.14005 -8.00956,1.61496 -9.42877,-6.99818 3.31149,-4.8775 -6.19885,-13.63747 z m 1.25608,-123.2428 1.6639,6.34566 23.49036,-3.26256 7.65067,13.45802 10.03235,-1.4192 v 0 l -0.0163,5.83995 11.85936,4.92645 -4.58387,5.69316 8.84151,13.34383 -8.49894,2.16959 -7.34074,14.25735 -9.36351,-0.22838 -4.63284,13.37644 -46.96439,3.81719 -3.70301,20.83139 7.04712,21.77752 v 0 l -50.53689,21.36969 -16.73689,-8.36844 -10.68485,5.67684 -7.43863,-5.3832 -9.82026,8.93938 -10.97848,-5.2364 -20.19519,5.05695 -8.972,10.04868 -1.69654,17.42199 -8.2053,10.32598 -37.9761,-3.99663 4.45339,-6.72085 -12.64238,-9.85288 -15.49711,7.22652 -9.83659,-3.62142 2.43061,-15.95386 -13.1644,-11.77781 -9.41244,14.33891 -9.706104,-1.01139 -1.321331,12.31611 -11.239486,2.95261 v 0 l -6.508786,-14.11052 8.188999,-10.91324 -3.458302,-18.8249 10.21178,-12.77289 1.223457,-19.9668 -5.269017,-3.49092 v 0 l 19.65686,-6.67191 13.76798,-14.58361 5.17113,-9.88552 -4.8775,-29.05301 5.56264,-0.14682 -3.32781,5.69315 8.85782,3.94768 6.32935,0.24469 3.40937,-6.73715 23.29461,10.48909 14.22472,-4.38814 3.89874,4.60022 -6.31303,5.92152 8.62945,0.29363 5.39951,15.82336 18.12345,0.34256 11.74519,-7.17761 6.19885,1.10927 -3.80087,6.31303 5.80733,-0.3915 9.03727,-10.03235 10.97848,0.8809 -4.89382,-5.33426 6.42722,-7.86276 18.22134,-0.32625 8.35213,-15.28503 27.09548,2.44691 21.35338,-8.31951 25.21951,3.68667 -5.17114,-18.07451 12.08775,-8.28687 z"
            class="land"
            title="Tyrol"
            id="AT-7"
            style=""
        />
        <path
            d="m 40.020756,522.14477 1.712839,8.97202 7.618053,3.68668 12.479253,-3.49094 3.947687,12.18562 11.679928,4.66544 1.125579,19.85263 11.027419,-7.22655 7.06342,2.03909 -7.487552,21.40234 v 0 l 5.252704,3.47459 -1.223456,19.96683 -10.21178,12.77286 3.458302,18.84124 -8.188999,10.89691 6.508786,14.11052 v 0 l -5.236392,1.82705 -11.255797,-11.41892 -18.384467,-6.362 0.228376,-16.39429 -35.366037,-7.68332 3.050484,-13.24596 -8.1890004,-8.20529 -4.9101375,-18.6618 18.5639089,-23.00096 -1.957532,-12.15301 -8.156373,-2.05541 -12.29981265,-18.33552 30.04808265,5.22007 z"
            class="land"
            title="Vorarlberg"
            id="AT-8"
            style=""
        />
        <path
            d="m 899.44164,381.85514 0.55464,0.1305 v 0 l 18.97172,10.76641 3.00154,24.38754 -7.27547,-4.29024 -10.14655,7.63436 -27.92742,-0.84827 -5.05696,-9.16775 2.90368,-17.7809 6.60666,4.0619 9.98341,-8.22164 v 0 l 2.80579,0.0163 v 0 l 5.15483,-6.90029 v 0 z"
            class="land"
            title="Vienna"
            id="AT-9"
            style=""
        />
        <!-- Triadic colors: -->
        <!-- https://www.color-hex.com/color/f69a69 -->
        <g
            id="stadiums"
            data-country="austria"
            data-circle-radius={radius}
            data-circle-colors="#9a69f6,#69f69a"
            on:mouseover={handleMouseOverCircle}
            on:mouseout={handleMouseOutCircle}
            on:focus={() => {}}
            role="presentation"
            on:blur={() => {}}
            use:a={stadiumsArray}
        /></g
    >
</svg>
