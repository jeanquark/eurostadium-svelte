<script>
    import { createEventDispatcher, onMount } from "svelte";
    import panzoom from "@panzoom/panzoom";
    import { stadiumStore } from "../../../store/stadium";
    import addStadiumsToSvgMap from "@utils/addStadiumsToSvgMap";
    import filterStadiums from "@utils/filterStadiums";
    const dispatch = createEventDispatcher();

    export let countryObj;
    export let stadiumsArray;
    let radius = 15;
    let stadiumObj;
    let panzoomRef;
    let flag = 1;
    $: updateStadiums(stadiumsArray);

    onMount(() => {
        console.log("[Albania] onMount");
    });

    const initPanzoom = (node) => {
        node.addEventListener("panzoompan", (event) => {
            if (event.detail.x != 0 || event.detail.y != 0) {
                flag = 0;
            }
        });
        node.addEventListener("panzoomzoom", (event) => {
            const scale = event.detail ? event.detail.scale : 10;
            const stadiumElement = document.getElementById("stadiums");
            if (!stadiumElement) {
                return;
            }
            const stadiums = stadiumElement.children;
            for (let i = 0; i < stadiums.length; i++) {
                stadiums[i].setAttribute("r", radius / scale);
            }
        });

        node.addEventListener("click", (event) => {
            if (flag == 1) {
                handleClick(event);
            }
            flag = 1;
        });
        panzoomRef = panzoom(node, {
            isSvg: true,
            cursor: "normal",
            disableZoom: false,
            maxScale: 8,
            minScale: 1,
            touchAction: "none",
            contain: "outside",
            panOnlyWhenZoomed: false,
            handleStartEvent: (event) => {
                event.preventDefault();
                event.stopPropagation();
            },
        });
        const zoom = (e) => {
            panzoomRef.zoomWithWheel(e);
        };
        node.addEventListener("wheel", zoom);
    };

    const handleClick = (e) => {
        if (e.target.classList.contains("rectangle")) {
            panzoomRef.destroy();
            dispatch("clickOutsideCountry");
        }
    };
    const handleMouseOverCircle = (e) => {
        const stadiumId = parseInt(
            e.target.getAttribute("data-api-football-stadium-id"),
        );

        const data = {
            stadiumId: stadiumId,
            clientX: e.clientX,
            clientY: e.clientY,
            rect: e.target.getBoundingClientRect(),
        };
        document.querySelectorAll(".stadium").forEach((element) => {
            element.classList.remove("hover");
        });
        e.target.classList.add("hover");
        dispatch("stadiumHover", data);
    };
    const handleMouseOutCircle = (e) => {
        if (!e.relatedTarget?.classList?.contains("tooltip")) {
            e.target.classList.remove("hover");
            dispatch("stadiumLeave");
        }
    };

    const a = (node, stadiums) => {
        stadiumObj = node;
        addStadiumsToSvgMap(stadiumObj, stadiums, countryObj.leagues);
    };
    const updateStadiums = (stadiums) => {
        if (stadiumObj) {
            addStadiumsToSvgMap(stadiumObj, stadiums, countryObj.leagues);
        }
    };
</script>

<svg
    xmlns="http://www.w3.org/2000/svg"
    version="1.1"
    id="map-northern_ireland"
    viewBox="0 0 1000 1000"
    width="100%"
    class=""
    use:initPanzoom
>
    <defs id="defs4">
        <style type="text/css" id="style2">
            .land {
                fill: #93c4a3;
                fill-opacity: 1;
                stroke: white;
                stroke-opacity: 1;
                stroke-width: 0.5;
            }
            .rectangle:hover {
                fill: #bdbdbd;
                cursor: pointer;
            }
            #stadiums:focus {
                outline: none;
            }
            .hover {
                fill: #ffffff !important;
            }
            .test {
                border: 2px solid red;
            }
        </style>
        <!-- <amcharts:ammap projection="mercator" leftLongitude="19.266289" topLatitude="42.660316"
		rightLongitude="21.056942" bottomLatitude="39.645057"></amcharts:ammap> -->
        <!-- All areas are listed in the line below. You can use this list in your script. -->
        <!--{id:"AL-01"},{id:"AL-09"},{id:"AL-02"},{id:"AL-03"},{id:"AL-04"},{id:"AL-05"},{id:"AL-06"},{id:"AL-07"},{id:"AL-08"},{id:"AL-10"},{id:"AL-11"},{id:"AL-12"}-->
    </defs>
    <rect
        id="background"
        class="rectangle"
        stroke-width="0"
        stroke="#000"
        width="1000"
        height="1000"
        x="0"
        y="0"
        fill="#d3d3d3"
    />
    <g>
        <path
            id="GBDRY"
            class="land"
            d="m 705.93731,99.51391 -5.41122,0.7708 -3.86947,2.32771 -3.86947,2.32772 -4.64034,3.86947 8.50981,1.54175 9.28069,-0.7708 8.50982,0.7708 8.5249,6.96805 -1.55684,3.0986 v 2.31262 3.0986 l -0.77081,4.64035 2.32773,-3.86947 3.86947,-6.96807 2.31263,-8.50981 -0.77096,-6.18201 -3.86947,-2.32772 z m -87.44095,40.25153 -7.73895,0.77079 -7.73893,4.64035 -6.96807,6.19719 -3.09859,3.0835 -2.32772,4.65544 -6.1821,4.64034 -25.54452,1.54176 -41.00733,19.34735 -30.18488,1.55683 -17.03472,0.7708 -6.95298,-2.32771 -15.47787,-10.83754 h -6.1972 l -1.54175,9.29579 -2.3277,28.62804 -4.64035,6.19718 -3.86947,4.64034 -4.64035,10.06666 -2.32773,11.60842 v 8.50981 l -5.41121,3.86946 -7.73893,10.05157 -4.65545,3.0986 -12.37928,1.55684 -12.37928,-1.55669 -5.41122,-3.09859 -10.06666,-5.41123 -6.96807,-0.7708 -16.24875,5.41123 -5.41122,-0.7708 3.08351,-11.60841 -6.95298,2.32771 -3.09859,4.64035 -3.0986,3.86948 -3.09859,3.86946 -22.44594,3.0986 -4.64035,3.86947 -3.86947,3.86947 -10.05157,16.24875 1.54176,5.41122 -0.77081,0.7708 -2.3277,0.78596 -1.54176,4.64035 2.31263,16.24875 -0.77079,5.41122 -2.31264,3.86948 -0.78596,0.78597 -6.95297,3.0835 -3.0986,3.86946 -0.7708,7.73894 1.54175,15.47787 v 6.96808 l -3.86947,13.16525 -6.19718,11.6084 -26.30033,32.49751 -2.32771,8.50982 -0.77079,15.47787 1.54174,5.42632 1.55684,1.54175 v 1.54175 l -4.65574,2.32779 -3.86948,-0.77079 -6.18209,-3.09859 -10.83753,3.09859 -12.37928,-3.86948 -6.96807,3.86948 -12.37928,13.15016 -12.37929,6.96806 -12.39437,0.77079 -12.37929,-6.18209 -10.05156,-9.29578 h -4.65544 l -12.37928,12.37928 -18.576471,9.29579 6.197188,4.64034 2.327717,1.54176 -3.098594,9.29578 3.098594,6.18209 6.182096,3.86948 6.19718,2.3277 3.0986,1.54176 3.86947,7.73894 2.31262,3.0986 3.0986,0.77079 6.19719,-4.64035 2.31262,-0.77079 5.42632,3.09859 11.60841,10.05157 5.41122,2.32771 6.19718,-3.09859 5.41122,-3.86947 3.86947,0.7708 0.7708,12.39437 -14.707,5.41123 -36.36698,34.82522 -13.93613,5.41123 -13.921026,-0.77081 -27.857163,-6.18209 -6.968063,8.50982 -7.738939,10.83752 -4.640346,9.2807 -1.556842,2.32771 -4.640346,3.86948 -8.509814,5.41122 -19.347347,5.41122 -6.9680632,3.86947 -1.5417515,0.78596 4.6403453,4.64035 0.7709531,4.64034 0.7707983,5.41123 3.869469,4.65543 8.509814,10.05157 15.477879,21.67506 8.524905,9.28069 9.280691,4.64035 h 10.066657 l 7.73894,19.34735 4.640344,9.29578 6.182097,6.96806 3.86947,0.7708 2.327718,1.54175 14.707,2.32772 5.41122,3.86946 2.32771,10.05158 0.77081,27.08635 5.41122,10.06666 6.96806,3.86948 19.34735,3.09859 21.67506,-1.55684 6.96807,0.78596 25.52945,20.11822 3.09859,3.86947 0.77079,5.41122 0.7708,5.42633 4.65544,3.08349 38.69469,9.29578 7.73894,-1.55683 14.69192,-12.3793 9.29578,0.7708 -4.64035,5.42632 1.54206,0.7708 h 3.86947 l 3.09859,0.7708 2.31264,5.4263 0.78596,2.31263 1.54174,0.77079 5.41123,-1.54175 17.80559,6.1972 3.86948,-0.78597 h 1.54175 l -7.73894,-17.01963 v -4.64034 l 2.32771,-3.09845 10.83753,-6.19718 1.54176,1.55683 -0.7708,3.86948 -0.77079,6.18209 v 6.96808 5.4263 l 0.77079,2.31262 5.41122,-2.31262 3.09859,-3.86947 2.32773,-5.42631 1.54175,-6.18209 -1.54175,-6.19719 6.96806,-3.86948 -0.78597,-3.09859 -3.0835,-3.0986 -1.55684,-2.31262 1.55684,-6.19719 2.31262,-3.86947 3.0986,-3.09859 3.86947,-3.0835 20.11822,-5.42631 7.73894,-5.41122 -2.31263,-10.06665 5.41122,-6.96815 -13.15015,-10.82244 2.31262,-8.52491 -12.37936,-6.18209 -0.77088,-6.96807 h 1.54176 l 3.09859,0.7708 1.54174,-3.0986 0.78598,0.78598 2.31262,-6.1972 -0.77079,-1.54175 -1.54175,-3.0986 -0.78598,-3.86945 0.78598,-2.32773 0.7708,-0.77079 1.54174,-0.7708 6.19719,0.7708 h 3.09859 l 11.60842,-8.50983 17.7905,-28.64312 10.83753,-10.05157 10.83753,-0.7708 12.37929,6.1821 22.44594,18.57647 3.09859,4.64035 3.08351,10.06665 3.0986,1.54175 3.86946,0.7708 2.32773,2.32772 3.86946,10.06665 3.86947,11.60842 0.7708,8.50982 -3.0986,6.18209 -6.1821,3.86947 13.15025,6.19718 3.09859,3.86948 1.54176,5.41122 1.55683,6.19725 1.54175,6.1972 6.1972,10.05157 6.95296,7.73894 7.73895,6.96806 7.73893,4.64035 4.65544,0.77079 3.0835,-3.0835 2.32772,-3.86946 3.86946,-2.32765 h 4.64035 l 3.86947,2.32772 7.73894,6.95297 5.42632,6.19719 2.31263,3.09859 2.3277,11.60841 -3.09859,10.83753 -8.50981,10.82244 3.86947,6.96807 -0.7708,6.96806 -5.42632,14.70701 5.42632,4.64034 10.05157,11.6084 5.42631,3.0986 1.54175,-1.55685 2.32773,-3.08349 1.54174,-3.0986 2.32771,-1.55684 2.31264,-0.77079 5.42631,2.3277 h 3.0835 l 30.95575,-11.6084 h 10.06659 v 0.7708 l 1.54175,3.09859 2.32771,2.31263 2.32773,1.55684 h 2.31262 l 9.29578,-3.09859 8.50982,-1.54175 2.31263,-2.32772 1.55684,-4.64035 v -5.4263 l -0.7708,-4.64035 0.7708,-3.86947 4.64035,-8.50981 3.09859,0.77079 3.09859,3.86948 3.86947,3.09859 4.64035,-0.77081 5.41122,-3.09858 h 5.42631 l 5.41122,3.86946 2.32771,-3.86946 7.73895,3.09858 10.82244,0.77081 9.29578,3.86946 4.64034,10.83754 4.64035,0.77079 27.85716,10.06666 -3.0835,0.7708 -7.73894,3.86946 v 3.0986 l 6.95297,5.41123 5.42631,0.77079 13.92103,-1.54175 5.42633,-2.32772 14.707,-11.6084 11.6084,-11.60841 15.47788,-7.73895 6.1821,-8.5098 3.86947,-10.06667 3.09859,-12.37928 2.32772,-12.37928 0.77079,-12.37929 v -2.32771 l -0.77079,-20.88911 2.31262,-7.73893 6.96807,-2.32773 6.96805,-1.54174 16.24877,-6.19726 15.47788,-1.54176 20.8891,2.31263 3.86946,4.65551 1.55685,4.64035 3.0986,0.7708 3.08349,-1.54175 2.32773,-1.55685 2.3277,-13.15024 1.54176,-0.7708 4.64035,1.54176 1.55684,-0.77081 11.60841,-12.37928 10.05157,-13.93613 3.86946,-17.80559 -3.09859,-23.98769 -10.82244,-11.60841 -15.47788,4.64035 -16.26385,10.06665 -14.6919,5.41123 3.86946,-6.95298 13.15016,-10.06643 3.0986,-6.19718 10.05157,-32.4975 -3.08352,-3.86948 2.31264,-3.86947 v -1.54175 l 0.7708,-3.0986 -4.64035,-1.55683 -2.31264,-5.41122 v -6.96807 l 1.54177,-7.73894 -10.83755,-6.18209 2.32773,-3.0986 7.73895,-1.55685 6.18209,-2.31262 -4.64035,-3.09859 -13.15016,-1.54175 -3.09859,-1.55685 -3.09859,-3.0986 -3.86948,-3.08349 h -5.41122 l 3.86947,-3.86948 3.09859,-5.4263 0.7708,-6.1821 -2.32756,-6.1972 v -3.86946 l 10.83753,0.7708 10.06666,5.42631 24.75857,23.9877 6.19719,10.83753 3.86946,13.92103 1.54176,20.11822 -1.54176,9.2958 -8.52491,10.83752 -2.31262,6.95297 0.7708,6.96806 2.32772,6.96807 3.86947,5.41122 3.86946,2.32771 3.86948,12.3793 3.86947,8.5098 3.86946,4.65545 5.41131,-0.7859 3.86946,-9.2807 5.41122,-3.09858 -4.64033,-6.1821 1.55683,-5.42632 4.64035,-3.86946 3.86947,-4.64035 0.7708,-10.83752 -2.32773,-10.05157 2.32773,-7.73895 6.96805,-10.83752 2.31264,-3.86948 v -3.09859 l -1.54168,-2.32771 v -3.86948 l 2.32772,-5.41122 -2.32772,-2.32771 -11.60841,-17.79051 -1.54175,-8.50981 -2.32772,-24.77367 -2.32771,-4.64034 -6.1821,-3.86946 -3.86947,-8.50982 -6.1972,-22.44594 -0.77079,-6.1972 v -5.41122 l -1.54175,-3.86946 -3.86947,-0.77081 -3.09859,-2.32771 -3.09859,-6.18217 -1.54176,-2.32772 -1.55684,-2.32772 -44.10591,6.96806 -7.73894,-0.77079 -5.42631,-3.86948 -6.1821,-2.32771 -7.73894,3.09859 -12.37929,10.06665 -12.39437,6.1821 -3.86948,3.86948 -7.73893,12.39437 v 0.77079 l -3.86947,3.86948 -2.31262,3.86947 -2.32773,3.09859 -4.64034,-0.78597 -1.54175,-3.0835 v -5.42631 l -1.55684,-5.41122 -4.64035,-3.09859 4.64035,-8.50982 8.50981,-16.24875 4.65543,-6.1972 2.31264,-3.09858 10.06665,-8.50982 9.2807,-5.41122 21.67506,-6.19719 10.83753,-5.41122 8.50982,-9.29578 4.64035,-13.92104 0.77079,-3.0986 0.7708,-14.707 -4.64035,-19.34735 -6.96806,-10.83752 -10.82244,-10.05157 -10.83754,-3.09859 -6.19719,10.83753 23.21682,24.75857 6.19719,13.93613 h -1.55684 l -9.28054,-13.16525 -10.06665,-4.64035 -9.2807,-5.41122 -3.86947,-17.8056 -1.54175,-8.50981 -2.32772,-7.73895 -3.09859,-6.96805 -3.09859,-4.64035 -3.0835,-3.0986 -5.42633,-5.41122 -2.31262,-2.32771 -2.32771,-4.64035 -2.32772,-10.06665 -1.54175,-4.64035 -7.73894,-10.83754 -8.50981,-7.73893 -10.06667,-5.41122 -10.05155,-1.55685 -0.78597,-4.64033 6.19719,-23.21682 0.77079,-11.60842 -2.31263,-6.18209 -2.32764,-1.55684 -2.32771,-2.31263 -5.41123,-2.32772 -5.41122,-0.77081 -6.19718,0.77081 -6.96808,-0.77081 -3.09858,-6.19718 5.42631,-13.15016 2.31262,-10.83753 1.55685,-35.5961 -3.86947,-6.19718 -13.16525,-15.47789 -3.0835,-1.54175 -3.0986,-4.64035 -6.96806,-3.86946 -14.707,-2.32772 -6.96806,1.54175 -13.92104,5.4263 -7.73894,1.54177 -6.19718,-1.54177 -34.82523,-20.11821 -9.28077,-2.32771 -13.93613,9.28069 -8.50982,-3.08351 z"
            style=""
        />
        <g
            id="stadiums"
            data-country="northern_ireland"
            data-circle-radius={radius}
            data-circle-colors="#a149be,#bea149"
            on:mouseover={handleMouseOverCircle}
            on:mouseout={handleMouseOutCircle}
            on:focus={() => {}}
            role="presentation"
            on:blur={() => {}}
            use:a={stadiumsArray}
        /></g
    >
</svg>
