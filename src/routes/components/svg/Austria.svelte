<script>
    import { createEventDispatcher, onMount } from 'svelte'
    import panzoom from '@panzoom/panzoom'
    import { stadiumStore } from '../../../store/stadium'
    import addStadiumsToSvgMap from '../../../utils/addStadiumsToSvgMap'
    import filterStadiums from '../../../utils/filterStadiums'
    const dispatch = createEventDispatcher()

    export let countryObj
    export let stadiumsArray
    let radius = 15
    let stadiumObj
    let panzoomRef
    let flag = 1
    $: updateStadiums(stadiumsArray)

    onMount(() => {
        console.log('[Austria] onMount')
    })

    const initPanzoom = (node) => {
        node.addEventListener('panzoompan', (event) => {
            if (event.detail.x != 0 || event.detail.y != 0) {
                flag = 0
            }
        })
        node.addEventListener('panzoomzoom', (event) => {
            const scale = event.detail ? event.detail.scale : 10
            const stadiumElement = document.getElementById('stadiums')
            if (!stadiumElement) {
                return
            }
            const stadiums = stadiumElement.children
            for (let i = 0; i < stadiums.length; i++) {
                stadiums[i].setAttribute('r', radius / scale)
            }
        })

        node.addEventListener('click', (event) => {
            if (flag == 1) {
                handleClick(event)
            }
            flag = 1
        })
        panzoomRef = panzoom(node, {
            isSvg: true,
            cursor: 'normal',
            disableZoom: false,
            maxScale: 8,
            minScale: 1,
            touchAction: 'none',
            contain: 'outside',
            panOnlyWhenZoomed: false,
            handleStartEvent: (event) => {
                event.preventDefault()
                event.stopPropagation()
            }
        })
        const zoom = (e) => {
            panzoomRef.zoomWithWheel(e)
        }
        node.addEventListener('wheel', zoom)
    }

    const handleClick = (e) => {
        if (e.target.classList.contains('rectangle')) {
            panzoomRef.destroy()
            dispatch('clickOutsideCountry')
        }
    }
    const handleMouseOverCircle = (e) => {
        const stadiumId = parseInt(e.target.getAttribute('data-api-football-stadium-id'))
        const data = {
            stadiumId: stadiumId,
            clientX: e.clientX,
            clientY: e.clientY,
            rect: e.target.getBoundingClientRect(),
        }
        document.querySelectorAll('.stadium').forEach((element) => {
            element.classList.remove('hover')
        })
        e.target.classList.add('hover')
        dispatch('stadiumHover', data)
    }
    const handleMouseOutCircle = (e) => {
        if (!e.relatedTarget?.classList?.contains('tooltip')) {
            e.target.classList.remove('hover')
            dispatch('stadiumLeave')
        }
    }
    const a = (node, stadiums) => {
        stadiumObj = node
        addStadiumsToSvgMap(stadiumObj, stadiums, countryObj.leagues)
    }
    const updateStadiums = (stadiums) => {
        if (stadiumObj) {
            addStadiumsToSvgMap(stadiumObj, stadiums, countryObj.leagues)
        }
    }
</script>

<svg xmlns="http://www.w3.org/2000/svg" version="1.1" id="map-austria" viewBox="0 0 1000 1000" width="100%" class="" use:initPanzoom>
    <defs id="defs4">
        <style type="text/css" id="style2">
            .land {
                fill: #f69a69;
            fill-opacity: 1;
            stroke: white;
            stroke-opacity: 1;
            stroke-width: 0.5;
            }
            .rectangle:hover {
                fill: #bdbdbd;
                cursor: pointer;
            }
            #stadiums:focus {
                outline: none;
            }
            .hover {
                fill: #ffffff !important;
            }
            .test {
                border: 2px solid red;
            }
        </style>
        <!-- <amcharts:ammap projection="mercator" leftLongitude="9.501127" topLatitude="49.015154" rightLongitude="17.163378" bottomLatitude="46.370917"></amcharts:ammap> -->
    <!-- All areas are listed in the line below. You can use this list in your script. -->
    <!-- {id:"AT-1"},{id:"AT-2"},{id:"AT-3"},{id:"AT-4"},{id:"AT-6"},{id:"AT-5"},{id:"AT-7"},{id:"AT-8"},{id:"AT-9"}-->
    </defs>
    <rect id="background" class="rectangle" stroke-width="0" stroke="#000" width="1000" height="1000" x="0" y="0" fill="#d3d3d3" />
    <g>

     <path
     d="m 986.8952,421.03501 -0.13045,16.19136 11.88668,4.77752 -8.60927,7.09289 -1.174,18.47412 -9.83221,3.22848 8.25058,9.70179 2.15233,19.35462 -27.01822,3.8481 -2.28277,-6.27762 -5.02209,7.35379 -10.23985,0.24457 -3.83178,-9.89743 -14.67496,-5.44604 -23.96908,18.45784 29.74122,8.18536 8.23428,16.04459 -8.23428,7.66359 1.22292,8.44625 -10.97361,9.37565 -16.92511,-0.11413 -1.69576,10.56596 7.22332,13.84337 -9.62024,14.36515 5.03842,12.04975 9.78329,3.01652 -8.73974,6.245 7.56574,6.94615 -10.61487,5.28299 9.63654,5.25036 -28.7792,-2.21754 -2.31539,9.73439 -18.44152,16.48486 -17.5121,7.81031 v 0 l 20.65908,-29.96949 -8.77238,-16.37071 3.47309,-13.06072 -10.9736,-44.66075 17.91975,-8.18536 v 0 l 14.51188,-6.27763 7.63097,-11.52798 -3.29372,-9.65286 7.69621,-15.08258 -8.54409,-8.36472 -0.55439,-18.7024 -4.56553,-1.61425 2.28275,-3.50569 5.10364,4.30466 8.20166,-10.46812 -4.90794,-4.46771 8.10382,-2.96761 4.66336,-10.33769 9.22893,-1.69577 7.89185,10.90838 15.55546,-15.34347 1.10877,-9.08216 15.84895,-2.90239 8.05491,-9.14737 11.65843,9.91374 4.54924,-9.84854 -5.26669,-5.93519 7.89187,3.66874 4.1905,-6.37545 v 0 z"
     class="land"
     title="Burgenland"
     id="AT-1"
     style="" />
  <path
     d="m 410.49584,616.30966 10.79424,-5.69061 0.68483,5.36449 23.7245,4.19052 18.06648,12.09868 24.8496,-5.72322 3.52198,-8.88651 11.47906,-0.57068 4.61446,5.38082 38.36684,5.6743 11.80518,18.16434 v 0 l 8.593,6.48958 10.66381,-2.13603 10.98988,-15.83264 24.47457,-13.28898 3.97854,9.06585 17.30013,0.55439 4.38617,8.42995 9.94636,-8.25058 17.91974,4.94057 29.82276,-9.99527 23.90385,26.51274 -6.71786,23.4473 6.96245,3.26111 -0.8642,18.24585 5.72325,4.01115 v 0 l -11.52799,9.27783 -3.03283,-4.87535 -11.43015,4.87535 -6.44066,17.77298 -13.43574,1.35336 -1.84253,7.1092 -14.8054,6.57112 -3.01651,10.61486 -5.33188,-9.71806 -9.91376,0.47286 -2.07079,-4.59815 -35.44816,2.26646 -5.28299,-8.0386 -26.78993,-8.39734 -15.26195,2.935 -54.98214,-13.50096 -17.46318,5.16884 -9.29413,-6.99507 -41.83991,-3.53828 -20.26773,-9.7996 v 0 l 3.19588,-15.31086 28.07806,-4.7449 4.61445,-5.6091 -28.66507,-31.94248 -2.90237,-6.62002 6.29393,-8.6256 -7.28856,-0.73376 z"
     class="land"
     title="Carinthia"
     id="AT-2"
     style="" />
  <path
     d="m 721.42539,244.4791 15.94677,4.23943 0.55439,9.99527 13.15854,-2.20124 2.25015,-8.16905 24.73544,8.54407 28.87703,18.99591 19.37094,-4.30466 33.2143,25.79531 37.19284,3.44046 9.09847,-13.92491 11.8867,-2.75562 16.012,6.44067 2.42953,10.46813 28.64875,2.02188 6.63634,33.71978 -13.19114,18.78393 -2.23386,13.54987 16.09354,22.71356 2.28276,18.06647 11.98454,10.46813 v 0 l -4.19052,6.37545 -7.89185,-3.66874 5.28296,5.93519 -4.56552,9.84854 -11.64212,-9.91374 -8.07123,9.14737 -15.83264,2.88607 -1.10876,9.08218 -15.55546,15.34347 -7.89186,-10.90838 -9.22891,1.67947 -4.64707,10.35398 -8.12014,2.9676 4.90796,4.46771 -8.20167,10.46814 -5.10362,-4.28836 -2.28276,3.50569 4.56553,1.59794 0.55438,18.71871 8.52778,8.36472 -7.67988,15.08258 3.2774,9.63655 -7.63097,11.52798 -14.4956,6.27764 v 0 l -7.66357,-18.89808 -7.19073,6.50589 -18.00127,-8.67453 -3.63613,-7.7125 -5.39712,0.8805 1.4675,-10.14202 -15.01737,-2.0871 -3.16325,-14.95215 -5.49496,2.03821 -8.51147,-9.99529 -12.93026,0.81528 -13.24006,-7.32117 -0.81528,-5.72324 -13.71293,-0.9131 -1.46749,5.65801 -9.29413,-0.89682 -2.348,7.95709 -29.49665,1.64685 -5.80474,6.32654 -24.62132,-7.1418 v 0 l -3.73396,-19.8601 7.0929,-4.35357 -0.587,-5.59279 -4.17422,-6.34283 -29.46403,-11.31602 -5.90257,-9.16368 4.20682,-34.58395 11.36491,-1.56533 15.14782,13.46834 18.42522,-6.62003 6.42435,-8.21797 12.21284,6.27761 1.58162,-11.15296 -0.70114,-12.00085 -5.57647,-0.88048 2.85345,-12.89766 -6.17977,0.17938 3.09802,-6.53852 -9.60392,-11.62583 7.25594,-4.76119 -30.00211,-15.57176 v 0 l 15.32716,-38.12224 22.17549,1.40226 -0.16306,-41.12246 2.26646,-6.91353 z m 169.12062,143.83079 v 0 l -9.97897,8.21799 -6.60372,-4.06009 -2.90239,17.77299 5.05471,9.14738 27.91501,0.84789 10.14203,-7.63098 7.27224,4.28835 -3.0002,-24.37671 -18.94699,-10.76162 v 0 l -0.99464,-0.35872 v 0 l -5.15254,6.91352 v 0 l -0.81527,-1.2066 z"
     class="land"
     title="Lower Austria"
     id="AT-3"
     style="" />
  <path
     d="m 566.84926,292.75967 27.60522,18.86546 -6.40806,6.88093 7.35377,8.65822 26.69209,2.73932 8.23429,5.72323 6.78308,-8.07122 5.6254,0.92941 5.18515,-11.70734 4.23943,6.11456 7.64728,2.49474 6.50589,-4.79383 10.48443,8.5278 v 0 l 30.00212,15.57173 -7.25595,4.7612 9.60393,11.64214 -3.09803,6.5222 6.17978,-0.16307 -2.85348,12.89766 5.57649,0.88051 0.71745,12.00084 -1.59794,11.15296 -12.21281,-6.27761 -6.42438,8.21797 -18.44151,6.62001 -15.14781,-13.45201 -11.36493,1.54901 -4.20682,34.58394 5.88629,9.1637 29.48033,11.31602 4.15791,6.32653 0.587,5.60908 -7.09289,4.35359 3.71764,19.86008 v 0 l -5.88627,-3.16326 -21.76785,10.48442 -0.9131,5.72324 -26.98561,14.21839 -7.38638,-1.10877 -3.08174,-7.37008 -23.67559,6.40806 0.53809,-9.79961 -5.96782,-6.40806 -30.06732,-3.03282 -10.87579,17.05554 -0.21197,8.67454 8.07123,5.93519 -4.19051,17.44688 -17.91975,-2.1197 v 0 l -14.15317,-12.06607 5.9352,-15.78372 -5.03841,-4.53294 7.92449,-14.02272 -13.8923,-4.50033 3.42416,-9.47349 6.88092,2.6741 1.35336,-5.00577 -17.83822,0.73373 -13.59878,-6.86461 -0.9294,-23.20271 10.14202,2.07079 1.5164,-7.15812 -9.24521,-6.71787 -19.59921,7.9571 -12.89767,-14.41407 -14.96844,1.59793 -9.48979,7.3864 v 0 l -13.3216,-15.58806 0.16307,-9.62024 34.11109,-25.43656 40.76374,-13.28899 13.63141,-20.4797 v -25.02894 l 9.11476,-6.17979 29.00749,14.75648 11.91931,-19.55029 1.85883,-16.53377 -5.57648,-3.32633 z"
     class="land"
     title="Upper Austria"
     id="AT-4"
     style="" />
  <path
     d="m 683.00962,492.25743 24.62132,7.14181 5.82106,-6.34285 29.48033,-1.63054 2.348,-7.97339 9.31043,0.89681 1.45119,-5.67432 13.72924,0.9131 0.81527,5.72324 13.24007,7.32117 12.91395,-0.81528 8.51147,10.01158 5.49496,-2.0545 3.16325,14.95215 15.01737,2.0871 -1.4675,10.14202 5.39712,-0.8805 3.63613,7.7125 18.00127,8.67453 7.19073,-6.50589 7.61468,18.91438 v 0 l -17.91975,8.18536 10.9736,44.66075 -3.47309,13.06072 8.77238,16.37071 -20.65908,29.96949 v 0 l -1.50011,17.96867 6.22871,16.012 -25.15938,-12.73459 -31.90987,6.19609 -12.19651,14.2836 -11.52799,-7.7451 -45.44341,0.66853 v 0 l -5.72325,-4.01115 0.8642,-18.24585 -6.96245,-3.26111 6.71786,-23.4473 -23.90385,-26.51274 -29.82276,9.99527 -17.91974,-4.94057 -9.94636,8.25058 -4.38617,-8.42995 -17.30013,-0.55439 -3.97854,-9.06585 -24.47457,13.28898 -10.98988,15.83264 -10.66381,2.13603 -8.593,-6.48958 v 0 l 16.20767,-23.18644 -3.61982,-8.08752 14.90322,-6.13086 -12.52262,-8.13645 -9.71807,-21.19714 -14.57711,6.65264 -13.58249,-4.69599 -5.658,-26.31708 2.85345,-10.01156 v 0 l 17.91975,2.1197 4.19051,-17.44688 -8.07123,-5.93519 0.21197,-8.67454 10.87579,-17.05554 30.06732,3.03282 5.96782,6.40806 -0.53809,9.79961 23.67559,-6.40806 3.08174,7.37008 7.38638,1.10877 26.98561,-14.21839 0.9131,-5.72324 21.76785,-10.48442 z"
     class="land"
     title="Styria"
     id="AT-6"
     style="" />
  <path
     d="m 438.21519,443.87902 9.48979,-7.3864 14.96844,-1.59793 12.89767,14.41407 19.59921,-7.9571 9.24521,6.71787 -1.5164,7.15812 -10.14202,-2.07079 0.9294,23.20271 13.59878,6.86461 17.83822,-0.73373 -1.35336,5.00577 -6.88092,-2.6741 -3.42416,9.47349 13.8923,4.50033 -7.92449,14.02272 5.03841,4.53294 -5.9352,15.78372 14.15317,12.06607 v 0 l -2.85345,10.01156 5.658,26.31708 13.58249,4.69599 14.57711,-6.65264 9.71807,21.19714 12.52262,8.13645 -14.90322,6.13086 3.61982,8.08752 -16.20767,23.18644 v 0 l -11.80518,-18.16434 -38.36684,-5.6743 -4.61446,-5.38082 -11.47906,0.57068 -3.52198,8.88651 -24.8496,5.72322 -18.06648,-12.09868 -23.7245,-4.19052 -0.68483,-5.36449 -10.79424,5.69061 v 0 l -20.07206,-10.46813 -12.34327,0.83157 -21.13192,15.91416 v 0 l -13.25637,-2.33167 v 0 l -7.04399,-21.75153 3.70136,-20.82213 46.94352,-3.81549 4.64707,-13.3542 9.35936,0.22827 7.33748,-14.25099 8.49516,-2.16863 -8.85388,-13.3379 4.59814,-5.70693 -11.85409,-4.92426 v -5.83736 0 l 3.96224,-7.79403 23.20271,-0.14675 -3.09804,4.30466 8.52777,7.4516 -5.70692,5.96783 2.10341,4.95686 26.78994,17.72408 5.77214,-5.56019 4.35356,-37.43741 -8.28318,-7.04399 h -14.2021 l 12.4574,-24.32779 z"
     class="land"
     title="Salzburg"
     id="AT-5"
     style="" />
  <path
     d="m 356.94859,622.58726 21.13192,-15.91416 12.34327,-0.84788 20.07206,10.48444 v 0 l 8.83758,10.82685 7.28856,0.71745 -6.29393,8.6256 2.90237,6.62003 28.66507,31.94248 -4.63075,5.60909 -28.07808,4.74489 -3.19587,15.31087 v 0 l -16.45224,0.96201 -19.38725,-9.09845 -7.87555,-14.25102 -9.27783,-1.71206 3.03283,-10.58228 -3.97855,-8.13643 -8.006,1.61424 -9.42458,-6.99506 3.31002,-4.87534 -6.19609,-13.6314 z m 1.25552,-123.18802 1.66316,6.34284 23.47992,-3.26111 7.64727,13.45204 10.02789,-1.41857 v 0 l -0.0163,5.83736 11.85409,4.92426 -4.58183,5.69062 8.83758,13.3379 -8.49517,2.16863 -7.33747,14.25101 -9.35935,-0.22828 -4.63078,13.3705 -46.94352,3.81549 -3.70136,20.82213 7.04399,21.76784 v 0 l -50.51443,21.36019 -16.72945,-8.36472 -10.6801,5.67432 -7.43532,-5.38081 -9.8159,8.93541 -10.9736,-5.23407 -20.18621,5.0547 -8.96801,10.04421 -1.69579,17.41425 -8.20165,10.32139 -37.95922,-3.99486 4.45141,-6.71786 -12.63676,-9.8485 -15.49022,7.22331 -9.83222,-3.61981 2.42953,-15.94677 -13.15855,-11.77258 -9.40826,14.33254 -9.701785,-1.01094 -1.320744,12.31064 -11.23449,2.95129 v 0 l -6.505892,-14.10424 8.185359,-10.90839 -3.456765,-18.81654 10.207241,-12.76721 1.222913,-19.95792 -5.266675,-3.48937 v 0 l 19.648118,-6.66895 13.76186,-14.57712 5.16884,-9.88113 -4.87534,-29.04009 5.56017,-0.14676 -3.32633,5.69062 8.85388,3.94593 6.32654,0.24458 3.40785,-6.73416 23.28426,10.48443 14.2184,-4.38619 3.897,4.59817 -6.31022,5.91889 8.62561,0.2935 5.39711,15.81633 18.1154,0.34241 11.73997,-7.17442 6.19609,1.10877 -3.79918,6.31023 5.80475,-0.39133 9.03325,-10.02789 10.9736,0.88051 -4.89164,-5.33189 6.42436,-7.85926 18.21324,-0.32611 8.34842,-15.27824 27.08344,2.44583 21.34388,-8.31582 25.2083,3.68504 -5.16884,-18.06648 12.08238,-8.28319 z"
     class="land"
     title="Tyrol"
     id="AT-7"
     style="" />
  <path
     d="m 39.888165,521.86822 1.712078,8.96803 7.614667,3.68504 12.473706,-3.48938 3.945932,12.1802 11.674736,4.66337 1.125079,19.8438 11.022517,-7.22334 7.06028,2.03819 -7.484223,21.39282 v 0 l 5.250369,3.47305 -1.222912,19.95795 -10.207241,12.76719 3.456765,18.83286 -8.185359,10.89207 6.505892,14.10425 v 0 l -5.234064,1.82623 -11.250794,-11.41384 -18.376295,-6.35917 0.228275,-16.38701 -35.350317,-7.6799 3.049128,-13.24007 -8.1853604,-8.20165 -4.9079549,-18.6535 18.5556573,-22.99074 -1.956662,-12.1476 -8.152747,-2.0545 L 0.75497116,528.3252 30.789697,533.54295 Z"
     class="land"
     title="Vorarlberg"
     id="AT-8"
     style="" />
  <path
     d="m 898.92703,381.64095 0.5544,0.13044 v 0 l 18.96329,10.76163 3.0002,24.3767 -7.27224,-4.28834 -10.14203,7.63097 -27.91501,-0.84789 -5.05471,-9.16368 2.90239,-17.77299 6.60372,4.06009 9.97897,-8.21799 v 0 l 2.80454,0.0163 v 0 l 5.15254,-6.89723 v 0 z"
     class="land"
     title="Vienna"
     id="AT-9"
     style="" />
  <g
     id="stadiums"
     data-country="austria"
     data-circle-radius={radius}
     data-circle-colors="#a149be,#bea149" on:mouseover={handleMouseOverCircle} on:mouseout={handleMouseOutCircle} on:focus={() => {}} role="presentation" on:blur={() => {}} use:a={stadiumsArray} /></g
    >
</svg>
