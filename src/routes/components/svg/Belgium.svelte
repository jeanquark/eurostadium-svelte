<script>
    import { createEventDispatcher, onMount } from 'svelte'
    import panzoom from '@panzoom/panzoom'
    import { stadiumStore } from '../../../store/stadium'
    import addStadiumsToSvgMap from '../../../utils/addStadiumsToSvgMap'
    import filterStadiums from '../../../utils/filterStadiums'
    const dispatch = createEventDispatcher()

    export let countryObj
    export let stadiumsArray
    let radius = 15
    let stadiumObj
    let panzoomRef
    let flag = 1
    $: updateStadiums(stadiumsArray)

    onMount(() => {
        console.log('[Albania] onMount')
    })

    const initPanzoom = (node) => {
        node.addEventListener('panzoompan', (event) => {
            if (event.detail.x != 0 || event.detail.y != 0) {
                flag = 0
            }
        })
        node.addEventListener('panzoomzoom', (event) => {
            const scale = event.detail ? event.detail.scale : 10
            const stadiumElement = document.getElementById('stadiums')
            if (!stadiumElement) {
                return
            }
            const stadiums = stadiumElement.children
            for (let i = 0; i < stadiums.length; i++) {
                stadiums[i].setAttribute('r', radius / scale)
            }
        })

        node.addEventListener('click', (event) => {
            if (flag == 1) {
                handleClick(event)
            }
            flag = 1
        })
        panzoomRef = panzoom(node, {
            isSvg: true,
            cursor: 'normal',
            disableZoom: false,
            maxScale: 8,
            minScale: 1,
            touchAction: 'none',
            contain: 'outside',
            panOnlyWhenZoomed: false,
            handleStartEvent: (event) => {
                event.preventDefault()
                event.stopPropagation()
            }
        })
        const zoom = (e) => {
            panzoomRef.zoomWithWheel(e)
        }
        node.addEventListener('wheel', zoom)
    }

    const handleClick = (e) => {
        if (e.target.classList.contains('rectangle')) {
            panzoomRef.destroy()
            dispatch('clickOutsideCountry')
        }
    }
    const handleMouseOverCircle = (e) => {
        const stadiumId = parseInt(e.target.getAttribute('data-api-football-stadium-id'))

        const data = {
            stadiumId: stadiumId,
            clientX: e.clientX,
            clientY: e.clientY,
            rect: e.target.getBoundingClientRect(),
        }
        document.querySelectorAll('.stadium').forEach((element) => {
            element.classList.remove('hover')
        })
        e.target.classList.add('hover')
        dispatch('stadiumHover', data)
    }
    const handleMouseOutCircle = (e) => {
        if (!e.relatedTarget?.classList?.contains('tooltip')) {
            e.target.classList.remove('hover')
            dispatch('stadiumLeave')
        }
    }

    const a = (node, stadiums) => {
        stadiumObj = node
        addStadiumsToSvgMap(stadiumObj, stadiums, countryObj.leagues)
    }
    const updateStadiums = (stadiums) => {
        if (stadiumObj) {
            addStadiumsToSvgMap(stadiumObj, stadiums, countryObj.leagues)
        }
    }
</script>

<svg xmlns="http://www.w3.org/2000/svg" version="1.1" id="map-belgium" viewBox="0 0 1000 1000" width="100%" class="" use:initPanzoom>
    <defs id="defs4">
        <style type="text/css" id="style2">
            .land {
                fill: #83c442;
            fill-opacity: 1;
            stroke: white;
            stroke-opacity: 1;
            stroke-width: 0.5;
            }
            .rectangle:hover {
                fill: #bdbdbd;
                cursor: pointer;
            }
            #stadiums:focus {
                outline: none;
            }
            .hover {
                fill: #ffffff !important;
            }
            .test {
                border: 2px solid red;
            }
        </style>
        <!-- <amcharts:ammap projection="mercator" leftLongitude="2.543698" topLatitude="51.499939" rightLongitude="6.408540" bottomLatitude="49.497691"></amcharts:ammap> -->
    <!-- All areas are listed in the line below. You can use this list in your script. -->
    <!--{id:"BE-VAN"},{id:"BE-BWR"},{id:"BE-BRU"},{id:"BE-WHT"},{id:"BE-WLG"},{id:"BE-VLI"},{id:"BEW-LX"},{id:"BE-WNA"},{id:"BE-VOV"},{id:"BE-VBR"},{id:"BE-VWV"}-->
    </defs>
    <rect id="background" class="rectangle" stroke-width="0" stroke="#000" width="1000" height="1000" x="0" y="0" fill="#d3d3d3" />
    <g>
        <path
        d="m 579.99758,94.852229 14.70059,7.941241 1.72635,24.02291 -19.09615,3.13401 29.5738,-1.15535 8.28652,9.78712 28.09975,-37.82048 12.84144,6.16176 6.77262,16.20119 -8.4193,15.90903 16.2543,32.34926 27.30298,4.56821 -0.82333,17.87441 v 0 l -5.96258,16.78549 12.3501,28.60439 -64.47276,30.74242 -8.08731,16.55973 v 0 l -42.38868,9.62776 -6.71951,-11.38067 -24.40801,16.3871 -3.41288,-10.69011 -26.0414,13.87724 -48.51062,-1.80603 -3.82453,-14.28892 -36.26676,-2.82858 v 0 l -12.7883,-1.35452 -4.0503,-24.92592 35.9082,-10.22534 4.44868,-12.03138 -10.87605,-40.5428 8.28652,-12.31025 -21.77865,-28.44502 v 0 l -5.4181,-8.71147 55.61523,4.12997 -13.77101,-33.98265 24.48769,-12.94765 16.81205,-1.69982 -0.6507,24.22211 26.89131,0.15936 z"
        class="land"
        title="Antwerp"
        id="BE-VAN"
        style="" />
     <path
        d="m 403.25858,420.56247 14.18268,-9.69414 23.89011,16.81205 22.73478,-18.51186 9.86678,7.19758 31.15408,-15.94887 8.22013,11.31426 18.20641,-14.7404 10.0527,8.67161 2.16457,-23.01366 30.41043,-3.05433 42.61444,25.86879 14.67402,-10.95573 9.69416,8.06076 v 0 l -9.45513,44.08847 v 0 l -49.81201,21.3537 -32.80076,-6.57343 1.28813,16.30743 -17.60883,-1.16861 -5.89616,11.19474 v 0 l -28.72392,5.33843 0.79679,-12.36336 -14.92634,-2.62938 -20.6366,8.59194 -38.98908,-47.9794 -19.49455,11.95167 z"
        class="land"
        title="Walloon Brabant"
        id="BE-WBR"
        style="" />
     <path
        d="m 487.65082,342.25232 1.03582,0.77021 v 0 l 15.28488,42.52148 -27.22329,11.15491 -35.90821,-21.92472 13.66476,-26.32028 20.82251,-6.16177 v 0 0 0 l 11.50019,-1.8857 v 0 z"
        class="land"
        title="Brussels Capital Region"
        id="BE-BRU"
        style="" />
     <path
        d="m 237.80728,395.68967 44.07519,19.0563 12.24385,-20.92873 21.04826,-3.58551 4.26278,13.63821 31.28687,6.268 v 0 l 4.12998,16.91829 48.40437,-6.50703 v 0 l 1.60683,30.11826 19.50782,-11.9384 38.97581,47.9794 20.6366,-8.59194 14.92634,2.64266 -0.79679,12.36335 28.72392,-5.3517 v 0 l -1.80605,40.6092 11.83219,6.79919 -6.04225,39.14845 -49.1613,6.21488 -29.81284,22.49574 29.16213,9.34888 -9.78711,25.66958 18.15329,90.79305 v 0 l -75.01679,-14.85994 4.67443,-27.58186 18.11345,-8.47241 -7.80844,-25.57663 -18.55168,-0.27888 20.66315,-55.78786 -11.93841,-6.89213 -6.37423,12.57582 -29.21526,-40.74199 -31.67199,12.92111 -39.93194,-9.77383 -10.22534,18.6048 -12.86799,-26.02812 0.41167,-35.04502 -13.4523,-15.94889 -27.90057,3.55894 4.70101,-14.70057 -11.39395,-3.89095 -25.49696,17.01126 -21.83176,-13.4523 -13.47885,-54.16773 5.52434,-17.72836 -21.47322,-22.21687 v 0 l 33.19916,0.23903 13.94365,18.64465 z m -154.243252,24.62049 -5.404822,-17.70178 30.768984,-9.61449 -6.12194,-8.07402 16.4535,-6.89215 4.80724,15.28489 v 0 l -20.53035,11.76578 -7.728764,20.91547 z"
        class="land"
        title="Hainaut"
        id="BE-WHT"
        style="" />
     <path
        d="m 814.88823,377.50982 -2.6825,21.84504 v 0 l 51.711,19.86637 2.50985,-18.85711 v 0 l 33.14605,0.13279 5.05953,14.89978 19.94606,-1.43421 15.6036,39.02893 23.66436,-0.0399 -23.38549,34.16858 12.29697,18.96335 32.13678,2.66921 6.61327,21.36698 -9.09657,22.76134 17.05107,18.0869 -11.9384,12.5891 -13.94365,-6.01567 -7.02493,20.80923 -26.73196,12.77503 3.74487,21.12795 -11.5533,2.93479 -1.67324,18.37905 -6.71952,-14.63419 -13.55854,5.25875 -9.402,-12.1376 v 0 l -11.71264,-59.18746 -30.14484,-6.90543 -4.48852,26.78509 9.2692,0.61086 -18.98992,10.10582 -21.61929,-2.85512 -0.54446,-38.68365 -47.83334,-13.94365 -6.36095,-13.13359 -11.34083,7.1179 -12.27041,-8.97704 -6.94526,20.49051 v 0 l -24.79313,5.73681 -16.14807,-15.55047 -9.64103,-30.70259 -9.04344,4.20965 -5.65715,-17.82129 -27.35609,-8.29979 -13.37263,-44.39391 v 0 l 9.45513,-44.08847 v 0 l 20.8225,16.77221 v 0 l 16.75893,5.40483 2.37707,-11.59315 33.55769,3.134 21.31387,-12.77503 7.9545,11.79234 15.19194,-1.95211 54.34037,-35.88165 v 0 z"
        class="land"
        title="Liege"
        id="BE-WLG"
        style="" />
     <path
        d="m 838.35339,395.07881 28.07319,5.29858 v 0 l -2.50985,18.84384 -51.711,-19.86637 v 0 z m -64.27358,-208.411 6.77264,22.84102 75.58783,32.01726 -34.54039,74.59186 9.45512,5.03299 -29.0559,32.07038 11.1549,24.23538 v 0 l -54.35364,35.88164 -15.19194,1.95211 -7.9545,-11.80561 -21.31387,12.77502 -33.55769,-3.10744 -2.37707,11.59315 -16.77221,-5.40483 v 0 l 21.97784,-79.17333 -24.40802,-2.20444 -12.52271,-13.69131 19.04302,-31.92431 10.69013,-1.47404 -10.41124,-10.49093 -15.47083,14.38186 -19.78668,-8.23338 v 0 l 8.08731,-16.55973 64.47276,-30.74242 -12.3501,-28.60439 5.96258,-16.78549 v 0 l 46.39913,-0.74367 17.71507,-15.69656 z"
        class="land"
        title="Limburg"
        id="BE-VLI"
        style="" />
     <path
        d="m 737.68028,553.4786 6.94526,-20.49051 12.27041,8.97704 11.34083,-7.1179 6.36095,13.13359 47.83334,13.94365 0.54446,38.68365 21.61929,2.85512 18.98992,-10.10582 -9.2692,-0.61086 4.48852,-26.78509 30.14484,6.90543 11.71264,59.18746 v 0 l -32.92027,28.61766 -20.14525,39.89211 4.50182,12.73519 -15.78953,8.06075 -10.43781,24.68689 12.58913,8.15371 -11.27444,17.1042 3.57223,18.04706 8.7513,-1.71307 9.74726,29.02934 15.20521,5.37826 -5.31185,12.93439 11.72594,5.05955 -17.92755,43.99552 -49.37377,0.55774 -9.91992,17.50259 -14.15611,-9.0036 -21.67241,12.73519 -11.15491,-38.94925 -20.79595,-13.87724 -9.04345,7.835 4.52836,-17.02453 -14.34203,-15.32473 -28.36535,-0.31871 -18.64465,-27.68808 -32.42893,-15.4841 v 0 l 5.3517,-20.5569 33.81001,-27.7545 -37.88686,-42.3754 17.8213,-9.82694 6.17504,-27.82089 2.65593,11.96496 49.95808,-8.1537 -6.91869,-8.15371 9.97302,-10.33159 -19.01647,-22.81445 48.25829,-29.00278 -1.42094,-11.18147 -11.88529,0.53118 13.35934,-8.59193 z"
        class="land"
        title="Luxembourg"
        id="BE-WLX"
        style="" />
     <path
        d="m 526.83911,487.77083 5.89616,-11.19474 17.60883,1.16861 -1.28813,-16.30743 32.80076,6.57343 49.81201,-21.3537 v 0 l 13.37263,44.39391 27.35609,8.29979 5.65715,17.8213 9.04344,-4.20965 9.64103,30.70259 16.14807,15.55047 24.79313,-5.73681 v 0 l 0.13279,17.44948 -13.35934,8.59193 11.88529,-0.53118 1.42094,11.18147 -48.25829,29.00278 19.01647,22.81445 -9.97302,10.33159 6.91869,8.15371 -49.95808,8.1537 -2.65593,-11.96496 -6.17504,27.82089 -17.8213,9.82694 37.88686,42.3754 -33.81001,27.7545 -5.3517,20.5569 v 0 l -30.31747,3.35976 -1.14205,-29.40116 10.62372,-17.10421 -25.49694,-23.70419 13.3195,-27.76778 -5.44467,-10.79636 19.68047,-28.7903 -17.9541,-12.74849 -34.38105,33.47803 -0.22576,35.77541 -66.86309,21.53961 v 0 l -18.15329,-90.79305 9.78711,-25.66957 -29.16213,-9.34889 29.81284,-22.49575 49.1613,-6.21487 6.04225,-39.14845 -11.83219,-6.78591 z"
        class="land"
        title="Namur"
        id="BE-WNA"
        style="" />
     <path
        d="m 438.62231,155.5934 21.77865,28.44504 -8.29979,12.31024 10.87603,40.5428 -4.43539,12.03138 -35.9082,10.22534 4.0503,24.92592 12.7883,1.35453 v 0 l -1.88571,14.58106 -22.73478,13.62494 4.75413,14.72714 -17.52915,-0.17263 -13.8507,38.47118 5.41811,19.94605 -29.1887,5.65712 0.73037,17.87443 h -14.47482 v 0 l -31.2736,-6.268 -4.26278,-13.63821 -21.06154,3.58551 -12.24384,20.92873 -44.06192,-19.0563 v 0 l 16.01527,-15.61689 -17.79474,-25.3243 6.70623,-12.21729 -16.12151,-2.93481 11.52674,-15.7364 -12.03137,-5.68369 8.36618,-37.01041 -29.68003,-21.1545 20.47724,-25.25793 -13.09376,-12.85471 5.49779,-34.03576 v 0 l 12.15089,12.31024 25.49694,-0.49134 -3.0012,-16.95814 19.56094,-7.79514 48.16534,17.59553 3.51909,19.95934 24.84626,-3.54568 -0.11953,9.33561 44.96494,-17.96739 z"
        class="land"
        title="East Flanders"
        id="BE-VOV"
        style="" />
     <path
        d="m 631.0446,286.53086 19.78668,8.23338 15.47083,-14.38186 10.41124,10.49093 -10.69013,1.47404 -19.04302,31.92431 12.52271,13.69131 24.40802,2.20444 -21.97784,79.17333 v 0 l -20.82251,-16.77221 v 0 l -9.68087,-8.06076 -14.67402,10.95573 -42.62772,-25.86879 -30.41043,3.05433 -2.16458,23.01366 -10.05271,-8.67161 -18.2064,14.7404 -8.22012,-11.31426 -31.15408,15.96215 -9.86678,-7.19758 -22.73479,18.51185 -23.89011,-16.79876 -14.18268,9.68087 v 0 l -48.40435,6.50703 -4.12998,-16.91829 v 0 h 14.46154 l -0.71709,-17.87442 29.1887,-5.65714 -5.41811,-19.93277 13.8507,-38.47118 17.54242,0.15936 -4.75413,-14.72715 22.73479,-13.62493 1.88572,-14.58107 v 0 l 36.26675,2.82857 3.82453,14.28892 48.51061,1.80603 26.04141,-13.87724 3.41287,10.69013 24.40803,-16.38711 6.7195,11.38067 z m -144.21712,53.87559 v 0 l -27.87401,3.9175 -17.95409,30.92832 35.74885,21.44665 27.22329,-11.16819 -15.29816,-42.5082 z"
        class="land"
        title="Flemish Brabant"
        id="BE-VBR"
        style="" />
     <path
        d="m 214.34212,149.40508 3.3332,38.4579 v 0 l -5.49779,34.03576 13.09376,12.85471 -20.47724,25.25793 29.68003,21.1545 -8.36618,37.01041 12.03137,5.68369 -11.52674,15.7364 16.12151,2.93481 -6.70623,12.21729 17.79474,25.3243 -16.01527,15.61689 v 0 l -25.81565,23.5714 -13.94366,-18.64465 -33.19915,-0.2523 v 0 l -7.02493,-13.79758 -33.7569,6.75935 v 0 l -4.80724,-15.28489 -16.4535,6.89215 6.12194,8.06074 -30.768984,9.61449 5.404822,17.70178 v 0 L 64.733469,412.42203 47.602707,378.28003 24.974165,377.43014 15.7448,362.25147 13.354462,333.63383 24.097707,322.30627 1.3363695,264.23431 166.34943,164.58373 l 0.67726,-13.49213 3.12073,14.11628 0.0797,-14.44827 7.7022,9.57463 z"
        class="land"
        title="West Flanders"
        id="BE-VWV"
        style="" />
  <g
     id="stadiums"
     data-country="belgium"
     data-circle-radius={radius}
     data-circle-colors="#a149be,#bea149" on:mouseover={handleMouseOverCircle} on:mouseout={handleMouseOutCircle} on:focus={() => {}} role="presentation" on:blur={() => {}} use:a={stadiumsArray} /></g
    >
</svg>
